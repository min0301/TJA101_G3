<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åƒç´ éƒ¨è½ - å•†åŸ - æ‰€æœ‰ç”¢å“</title>
<meta name="description" content="åƒç´ éƒ¨è½, Pixel Tribe, è™›æ“¬éŠæˆ²å•†åŸ - æ‰€æœ‰ç”¢å“">
<meta name="keywords" content="éŠæˆ²å•†åŸ, é›»ç«¶, éŠæˆ²ç©å®¶, å„ªæƒ æ´»å‹•, å•†å“è³¼è²·, æ‰€æœ‰ç”¢å“">
<meta name="robots" content="all,follow">
<script src="/js/dynamicHeaderInfo.js"></script>
<script>
	//Check local storage
	let localS = localStorage.getItem('theme')
	themeToSet = localS

	// If local storage is not set, we check the OS preference
	if (!localS) {
		themeToSet = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
	}

	//Set the correct theme
	document.documentElement.setAttribute('data-theme', themeToSet)
</script>

<!-- çµ±ä¸€ç”¨çµ•å°è·¯ç¶“  -->
<link rel="stylesheet" href="/assets/vendors/bootstrap/bootstrap.min.css">
<link rel="stylesheet" href="/assets/vendors/bootstrap-icons/bootstrap-icons.css">
<link rel="stylesheet" href="/assets/vendors/simplebar/simplebar.min.css">
<link rel="stylesheet" href="/assets/vendors/aos/aos.css">
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet" href="/assets/css/responsive.css">
<link rel="stylesheet" href="/assets/css/custom-style.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Karla&display=swap" rel="stylesheet">

</head>

<body>
	<div class="switcher switcher-show" id="theme-switcher">
		<i id="switcher-icon" class="bi bi-moon"></i>
	</div>

	<a href="#" id="back-to-top"></a>

	<div class="vine-wrapper">

		<div id="header-placeholder"></div>

		<section class="vine-hero-2 bg-img-1">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<div class="hero-content" data-aos="fade-down" data-aos-easing="linear">
							<h1>åƒç´ éƒ¨è½(Pixel Tribe)</h1>
							<p>éŠæˆ²æ„›å¥½è€…çš„èšé›†åœ° - æ‰€æœ‰ç”¢å“</p>
						</div>
					</div>
				</div>
			</div>
		</section>

		<section class="vine-main">
			<div class="container">
				<div class="row">
					<div class="col-lg-3 pe-lg-3 border-end">
						<div class="position-sticky" style="top: 100px;">
							<div class="mall-category-sidebar">
								<h5 class="mb-3">å¹³å°åˆ†é¡</h5>
								<div id="malltag-list">
									<!-- åˆ†é¡é …ç›®æœƒç”± malltag.js å‹•æ…‹è¼‰å…¥ -->
								</div>
								
								<!-- è¿”å›å•†åŸé¦–é æŒ‰éˆ• <<ä¿®æ­£çµ±ä¸€ç”¨å°è·¯å¾‘>> -->
								<div class="mt-4">
									<a href="/front-end/shopsys/shopindex.html" class="btn btn-outline-primary w-100">
										<i class="bi bi-house me-2"></i>è¿”å›å•†åŸé¦–é 
									</a>
								</div>
							</div>
						</div>
					</div>

					<div class="col-lg-9 ps-lg-5">
						<div id="dynamic-content-container">
							<!-- å•†å“åˆ—è¡¨æœƒç”± malltag.js å‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
						</div>
					</div>
				</div>
			</div>
		</section>
		
		<div id="footer-placeholder"></div>

	</div>
	
	<!-- ä¿®æ­£çµ±ä¸€ç”¨å°è·¯å¾‘ -->
	<script src="/assets/vendors/jquery/jquery.min.js"></script>
	<script src="/assets/vendors/bootstrap/bootstrap.bundle.js"></script>
	<script src="/assets/vendors/popper/popper.min.js"></script>
	<script src="/assets/vendors/simplebar/simplebar.min.js"></script>
	<script src="/assets/vendors/aos/aos.js"></script>
	<script src="/assets/js/main.js"></script>
	<script src="/assets/js/global-loader.js"></script>
	
	<!-- è³¼ç‰©è»Š Header ç³»çµ± -->
	<script src="/front-end/shopsys/mallCartHeader.js"></script>
	<script src="/front-end/shopsys/productListCartBridge.js"></script>
		
	
	
	<!-- ä¿®æ­£çµ±ä¸€ç”¨å°è·¯å¾‘ -->
	<script src="/front-end/shopsys/malltag.js"></script>
	<!-- <script src="/front-end/shopsysproductDetail.js"></script> -->
	
	<script>
	//*** é é¢åˆå§‹åŒ– - ç°¡åŒ–ç‰ˆï¼Œè®“ malltag.js å®Œå…¨æ¥ç®¡ ***//
	
	//*** é é¢åˆå§‹åŒ– - é©é…çµ„å“¡çš„æ··æ·†çµæ§‹ ***//
	document.addEventListener('DOMContentLoaded', function() {
    console.log('=== å•†å“é é¢é–‹å§‹åˆå§‹åŒ– ===');
    
    setTimeout(function() {
        try {
            // æª¢æŸ¥ URL åƒæ•¸
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            
            console.log('ç•¶å‰ URL åƒæ•¸:', {
                productId: productId,
                fullUrl: window.location.href,
                pathname: window.location.pathname
            });
            
            if (productId) {
                console.log('ğŸ“± æœ‰å•†å“IDï¼Œé¡¯ç¤ºå•†å“è©³æƒ…');
                initProductDetailMode(productId);
            } else {
                console.log('ğŸ“‹ æ²’æœ‰å•†å“IDï¼Œé¡¯ç¤ºå•†å“åˆ—è¡¨');
                initProductListMode();
            }
            
        } catch (error) {
            console.error('âŒ é é¢åˆå§‹åŒ–éŒ¯èª¤:', error);
	        }
	    }, 300);
	});
	
	// *** åˆå§‹åŒ–å•†å“è©³æƒ…æ¨¡å¼
	async function initProductDetailMode(productId) {
	    console.log('ğŸ”§ åˆå§‹åŒ–å•†å“è©³æƒ…æ¨¡å¼ï¼Œå•†å“ID:', productId);
	    
	    try {
	        // 1. å…ˆåˆå§‹åŒ–å·¦å´åˆ†é¡
	        await initLeftSidebar();
	        
	        // 2. å†è¼‰å…¥å•†å“è©³æƒ…
	        await showProductDetail(productId);
	        
	        console.log('âœ… å•†å“è©³æƒ…æ¨¡å¼åˆå§‹åŒ–å®Œæˆ');
	        
	    } catch (error) {
	        console.error('âŒ å•†å“è©³æƒ…æ¨¡å¼åˆå§‹åŒ–å¤±æ•—:', error);
	        showProductError('åˆå§‹åŒ–å¤±æ•—ï¼š' + error.message);
	    }
	}
	
	/**
	 * åˆå§‹åŒ–å•†å“åˆ—è¡¨æ¨¡å¼
	 */
	async function initProductListMode() {
	    console.log('ğŸ”§ åˆå§‹åŒ–å•†å“åˆ—è¡¨æ¨¡å¼');
	    
	    try {
	        if (window.mallTagManager && typeof window.mallTagManager.init === 'function') {
	            await window.mallTagManager.init();
	        } else {
	            console.warn('MallTagManager æœªæ‰¾åˆ°ï¼Œå˜—è©¦æ‰‹å‹•åˆå§‹åŒ–...');
	            setTimeout(async () => {
	                if (window.mallTagManager) {
	                    await window.mallTagManager.init();
	                }
	            }, 500);
	        }
	        
	        console.log('âœ… å•†å“åˆ—è¡¨æ¨¡å¼åˆå§‹åŒ–å®Œæˆ');
	        
	    } catch (error) {
	        console.error('âŒ å•†å“åˆ—è¡¨æ¨¡å¼åˆå§‹åŒ–å¤±æ•—:', error);
	    }
	}
	
	/**
	 * åˆå§‹åŒ–å·¦å´åˆ†é¡å´é‚Šæ¬„
	 */
	async function initLeftSidebar() {
	    console.log('ğŸ·ï¸ é–‹å§‹åˆå§‹åŒ–å·¦å´åˆ†é¡å´é‚Šæ¬„...');
	    
	    if (window.MallTagManager && !window.sidebarMallTagManager) {
	        try {
	            // å‰µå»ºå°ˆé–€ç”¨æ–¼å´é‚Šæ¬„çš„å¯¦ä¾‹
	            window.sidebarMallTagManager = new window.MallTagManager();
	            
	            // ä¿®æ”¹å…¶è¡Œç‚ºï¼šåªé¡¯ç¤ºåˆ†é¡ï¼Œä¸æ§åˆ¶å³å´å…§å®¹
	            window.sidebarMallTagManager.displayProducts = function() {
	                console.log('ğŸš« å´é‚Šæ¬„æ¨¡å¼ï¼šé˜»æ­¢æ§åˆ¶å³å´å•†å“é¡¯ç¤º');
	            };
	            
	            // ä¿®æ”¹é»æ“Šè¡Œç‚º
	            window.sidebarMallTagManager.handleMalltagClick = function(malltagItem) {
	                const tagId = malltagItem.dataset.malltagId;
	                const tagName = malltagItem.dataset.malltagName;
	                
	                console.log(`ğŸ”— å´é‚Šæ¬„åˆ†é¡é»æ“Š: ${tagName} (ID: ${tagId})`);
	                
	                if (tagId === 'all') {
	                    window.location.href = '/front-end/shopsys/product.html';
	                } else {
	                    window.location.href = `/front-end/shopsys/product.html?category=${tagId}`;
	                }
	            };
	            
	            await window.sidebarMallTagManager.init();
	            console.log('âœ… å·¦å´åˆ†é¡å´é‚Šæ¬„åˆå§‹åŒ–å®Œæˆ');
	            
	        } catch (error) {
	            console.error('âŒ å·¦å´åˆ†é¡å´é‚Šæ¬„åˆå§‹åŒ–å¤±æ•—:', error);
	        }
	    } else if (!window.MallTagManager) {
	        console.warn('âš ï¸ MallTagManager é¡åˆ¥æœªæ‰¾åˆ°');
	    }
	}
	
	

	// *** é¡¯ç¤ºå•†å“è©³æƒ… - æ•´åˆåº«å­˜ API (è–°å¦¤ä¿®) ***//
	async function showProductDetail(productId) {
    	try {
        	console.log('é–‹å§‹è¼‰å…¥å•†å“è©³æƒ…ï¼ŒID:', productId);
        
        	// é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        	const container = document.getElementById('dynamic-content-container');
        	if (!container) {
            	console.error('æ‰¾ä¸åˆ° dynamic-content-container');
            	return;
        	}
        
        	container.innerHTML = `
            	<div class="text-center py-5">
                	<div class="spinner-border text-primary" role="status"></div>
                	<h4 class="mt-3">è¼‰å…¥å•†å“è³‡è¨Šä¸­...</h4>
                	<p class="text-muted">è«‹ç¨å€™</p>
            	</div>
		        `;
		        
		        // ä½¿ç”¨å’Œ productList.js ç›¸åŒçš„ API
		        const apiBaseUrl = `${location.origin}/api`;
		        const apiUrl = `${apiBaseUrl}/product/searchall?proIsMarket=0`;
		        
		        console.log('è«‹æ±‚å•†å“ API:', apiUrl);
		        
		        const response = await fetch(apiUrl);
		        if (!response.ok) {
		            throw new Error(`HTTP error! status: ${response.status}`);
		        }
		
		        const products = await response.json();
		        console.log('è¼‰å…¥å•†å“åˆ—è¡¨:', products.length, 'é …');
		        
		        // å°‹æ‰¾ç›®æ¨™å•†å“
		        const product = products.find(p => 
		            String(p.id) === String(productId) || 
		            String(p.proNo) === String(productId)
		        );
		
		        if (!product) {
		            throw new Error(`æ‰¾ä¸åˆ°å•†å“ ID: ${productId}`);
		        }
		
		        console.log('æ‰¾åˆ°ç›®æ¨™å•†å“:', product);
		        
		        // æ–°å¢ï¼šè¼‰å…¥åº«å­˜è³‡è¨Š
		        let stockInfo = null;
		        try {
		            console.log('é–‹å§‹æŸ¥è©¢åº«å­˜è³‡è¨Š...');
		            const stockResponse = await fetch(`${apiBaseUrl}/cart/stock/${productId}`, {
		                headers: {
		                    'Authorization': 'Bearer ' + localStorage.getItem('jwt'),
		                    'Content-Type': 'application/json'
		                }
		            });
		            
		            if (stockResponse.ok) {
		                stockInfo = await stockResponse.json();
		                console.log('åº«å­˜è³‡è¨Šè¼‰å…¥æˆåŠŸ:', stockInfo);
		            } else {
		                console.warn('åº«å­˜ API å›æ‡‰å¤±æ•—:', stockResponse.status);
		            }
		        } catch (stockError) {
		            console.warn('ç„¡æ³•å–å¾—åº«å­˜è³‡è¨Š:', stockError);
		        }
		        
		        // é¡¯ç¤ºå•†å“è©³æƒ…ï¼ˆåŒ…å«åº«å­˜ï¼‰
		        displayProductDetailWithStock(product, stockInfo);
		        
		    } catch (error) {
		        console.error('è¼‰å…¥å•†å“è©³æƒ…å¤±æ•—:', error);
		        showProductError(error.message);
		    }
		}
	
	
	
	// å•†å“å¹³å°é¡¯ç¤º ä¿®æ­£
	// é«˜äº®å°æ‡‰çš„å·¦å´æ¨™ç±¤
	function highlightCorrespondingTag(mallTagNo) {
	    try {
	        console.log('ğŸ¯ å˜—è©¦é«˜äº®æ¨™ç±¤:', mallTagNo);
	        
	        // æ¸…é™¤æ‰€æœ‰æ¨™ç±¤çš„é«˜äº®
	        const allTags = document.querySelectorAll('.malltag-item, [data-malltag-id]');
	        allTags.forEach(tag => {
	            tag.classList.remove('active', 'malltag-active');
	        });
	        
	        // ç¢ºå®šè¦é«˜äº®çš„æ¨™ç±¤ID
	        let tagId;
	        if (mallTagNo && mallTagNo.id) {
	            tagId = mallTagNo.id;
	        } else if (typeof mallTagNo === 'number') {
	            tagId = mallTagNo;
	        }
	        
	        if (tagId) {
	            const targetTag = document.querySelector(`[data-malltag-id="${tagId}"]`);
	            if (targetTag) {
	                targetTag.classList.add('active');
	                console.log(`âœ… å·²é«˜äº®æ¨™ç±¤ ID: ${tagId}`);
	            }
	        }
	        
	    } catch (error) {
	        console.error('âŒ é«˜äº®æ¨™ç±¤å¤±æ•—:', error);
	    }
	}


	
	 

	
	
	// ***  é¡¯ç¤ºå•†å“è©³æƒ…å…§å®¹ åŒ…å«åº«å­˜ (è–°å¦¤ä¿®) ***//
	function displayProductDetailWithStock(product, stockInfo) {
		// åŠ å…¥é™¤éŒ¯è³‡è¨Š
	    console.log('ğŸ” æª¢æŸ¥å•†å“æè¿°è³‡æ–™:');
	    console.log('product.proDetails:', product.proDetails);
	    console.log('product.proInclude:', product.proInclude);
	    console.log('å®Œæ•´å•†å“ç‰©ä»¶:', product);

		
	    const container = document.getElementById('dynamic-content-container');
	    
	    // å¹³å°åç¨±é‚è¼¯
	    let platformName = 'æ¸¬è©¦å¹³å°';
	    
	    if (product.mallTagNo) {
	        if (typeof product.mallTagNo === 'object' && product.mallTagNo.mallTagName) {
	            platformName = product.mallTagNo.mallTagName;
	        } else if (typeof product.mallTagNo === 'number') {
	            const platformMap = {
	                1: 'Steam',
	                2: 'PlayStation',
	                3: 'Xbox',
	                4: 'Nintendo Switch',
	                5: 'Epic Games Store'
	            };
	            platformName = platformMap[product.mallTagNo] || `å¹³å° ${product.mallTagNo}`;
	        }
	    }

	    
	    // æ•´åˆåº«å­˜é‚è¼¯
	    const proIsmarket = product.proIsmarket;
	    const proStatus = product.proStatus;
	    
	    console.log('å•†å“ä¸Šæ¶ç‹€æ…‹ (proIsmarket):', proIsmarket);
	    console.log('å•†å“ç‹€æ…‹ (proStatus):', proStatus);
	    console.log('åº«å­˜è³‡è¨Š:', stockInfo);
	    
	    // æ ¹æ“šåº«å­˜è³‡è¨Šç”Ÿæˆç‹€æ…‹
	    let statusInfo = generateStatusInfo(proIsmarket, proStatus, stockInfo);
	    
	    const productId = product.id || product.proNo;
	    const apiBaseUrl = `${location.origin}/api`;
	    const imageUrl = `${apiBaseUrl}/product/cover/${productId}`;
	    
	    // æ›´æ–°é é¢æ¨™é¡Œ
	    document.title = `${product.proName} - åƒç´ éƒ¨è½`;
	    
	    // æ›´æ–° hero å€åŸŸæ¨™é¡Œ
	    const heroContent = document.querySelector('.hero-content p');
	    if (heroContent) {
	        heroContent.textContent = `å•†å“è©³æƒ… - ${product.proName}`;
	    }
	    
	    // é¡¯ç¤ºå®Œæ•´çš„å•†å“è©³æƒ…ï¼ˆåŒ…å«åº«å­˜ï¼‰
	    container.innerHTML = `
	        <div class="card shadow-sm border-0 ">
	            <div class="card-body p-4">
	                <!-- è¿”å›æŒ‰éˆ• -->
	                <div class="mb-4">
	                    <nav aria-label="breadcrumb">
	                        <ol class="breadcrumb">
	                            <li class="breadcrumb-item">
	                                <a href="/front-end/shopsys/shopindex.html">å•†åŸé¦–é </a>
	                            </li>
	                            <li class="breadcrumb-item">
	                                <a href="/front-end/shopsys/product.html">æ‰€æœ‰ç”¢å“</a>
	                            </li>
	                            <li class="breadcrumb-item active">${product.proName}</li>
	                        </ol>
	                    </nav>
	                </div>
	                
	                <div class="row">
	                    <!-- å•†å“åœ–ç‰‡ -->
	                    <div class="col-lg-6 mb-4">
	                        <div class="product-image-wrapper">
	                            <img src="${imageUrl}" 
	                                 alt="${product.proName}" 
	                                 class="img-fluid rounded shadow-sm w-100"
	                                 style="height: 400px; object-fit: cover;"
	                                 onerror="this.src='https://via.placeholder.com/400x400/667eea/ffffff?text=å•†å“åœ–ç‰‡'">
	                        </div>
	                    </div>
	                    
	                    <!-- å•†å“è³‡è¨Š -->
	                    <div class="col-lg-6">
	                        <h1 class="h2 mb-3 fw-bold">${product.proName || 'æœªçŸ¥å•†å“'}</h1>
	                        
	                        <div class="price-section mb-3 pb-3 border-bottom">
	                            <span class="h3 text-success fw-bold">NT$ ${formatPrice(product.proPrice || 0)}</span>
	                        </div>
	                        
	                        <!-- å•†å“ç‹€æ…‹é¡¯ç¤º -->
	                        <div class="status-section mb-3">
	                            <span class="${statusInfo.statusClass}">${statusInfo.displayText}</span>
	                        </div>
	                        
	                        <!-- å•†å“è¦æ ¼ -->
	                        <div class="product-info bg-light p-3 rounded mb-4">
	                            <div class="row">
	                                <div class="col-6">
	                                    <strong>ç‰ˆæœ¬ï¼š</strong><br>
	                                    <span class="text-muted">${product.proVersion || 'æ¨™æº–ç‰ˆ'}</span>
	                                </div>
	                                <div class="col-6">
	                                    <strong>å¹³å°ï¼š</strong><br>
	                                    <span class="text-muted">${platformName}</span>
	                                </div>
	                            </div>
	                        </div>
	                        
	                        <!-- åº«å­˜ç‹€æ…‹é¡¯ç¤ºï¼ˆä½¿ç”¨çœŸå¯¦è³‡æ–™ï¼‰-->
	                        <div class="stock-section mb-4 p-3 bg-light rounded">
	                            <div class="d-flex align-items-center gap-2 mb-2">
	                                <i class="bi bi-box-seam ${statusInfo.stockClass}"></i>
	                                <span class="fw-bold ${statusInfo.stockClass}">${statusInfo.stockText}</span>
	                            </div>
	                            <!-- åº«å­˜æ•¸é‡é¡¯ç¤º -->
	                            <div class="stock-quantity">
	                                <span class="text-muted">åº«å­˜æ•¸é‡ï¼š</span>
	                                <span class="fw-bold ${statusInfo.stockClass}">${statusInfo.stockCount}</span>
	                                
	                            </div>
	                        </div>
	                        
	                        <!-- æ“ä½œæŒ‰éˆ•æ ¹æ“šåº«å­˜ç‹€æ…‹èª¿æ•´ -->
	                        <div class="action-buttons">
	                            <div class="row">
	                                <div class="col-md-6 mb-2">
	                                    <button class="btn ${statusInfo.canPurchase ? 'btn-success' : 'btn-secondary'} btn-lg w-100" 
	                                            ${statusInfo.canPurchase ? '' : 'disabled'}
	                                            onclick="handleAddToCart(${productId})">
	                                        <i class="bi bi-cart-plus me-2"></i>${statusInfo.buttonText}
	                                    </button>
	                                </div>
	                                <div class="col-md-6 mb-2">
	                                    <button class="btn btn-danger btn-lg w-100" onclick="handleAddToFavorite(${productId})">
	                                        <i class="bi bi-heart me-2"></i>åŠ å…¥æœ€æ„›
	                                    </button>
	                                </div>
	                                <div class="col-12">
	                                    <a href="/front-end/shopsys/product.html" class="btn btn-outline-secondary w-100">
	                                        <i class="bi bi-arrow-left me-2"></i>è¿”å›å•†å“åˆ—è¡¨
	                                    </a>
	                                </div>
	                            </div>
	                        </div>
	                    </div>
	                    <div class="product-description mb-4">
	                        <h5>å•†å“å…§å®¹</h5>
	                        <div class="description-content p-3 bg-light rounded">
	                        	${product.proInclude}
	                    	</div>
                  		</div>
                        <div class="product-description mb-4">
                            <h5>å•†å“ç°¡ä»‹</h5>
                            <div class="description-content p-3 bg-light rounded">
                            	${product.proDetails}
                        	</div>
                        </div>
		                    <div class="game-gallery mb-4">
		                        <h5>éŠæˆ²ç•«é¢</h5>
		                        <div id="productImageCarousel" class="carousel slide" data-bs-ride="carousel">
		                            <!-- è¼ªæ’­æŒ‡ç¤ºå™¨ -->
		                            <div class="carousel-indicators" id="carouselIndicators">
		                                <!-- å‹•æ…‹ç”Ÿæˆ -->
		                            </div>
		                            
		                            <!-- è¼ªæ’­å…§å®¹ -->
		                            <div class="carousel-inner" id="carouselInner">
		                                <!-- è¼‰å…¥ä¸­ç‹€æ…‹ -->
		                                <div class="carousel-item active">
		                                    <div class="d-flex justify-content-center align-items-center" style="height: 400px; background-color: #f8f9fa;">
		                                        <div class="text-center">
		                                            <div class="spinner-border text-primary mb-3" role="status"></div>
		                                            <p class="text-muted">è¼‰å…¥éŠæˆ²ç•«é¢ä¸­...</p>
		                                        </div>
		                                    </div>
		                                </div>
		                            </div>
		                            
		                            <!-- è¼ªæ’­æ§åˆ¶æŒ‰éˆ• -->
		                            <button class="carousel-control-prev" type="button" data-bs-target="#productImageCarousel" data-bs-slide="prev">
		                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
		                                <span class="visually-hidden">Previous</span>
		                            </button>
		                            <button class="carousel-control-next" type="button" data-bs-target="#productImageCarousel" data-bs-slide="next">
		                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
		                                <span class="visually-hidden">Next</span>
		                            </button>
		                        </div>
		                    </div>
                    	</div>
                    </div>
	                </div>
	            </div>
	        </div>
	    `;
	    
	    loadProductImageCarousel(productId);
	    highlightCorrespondingTag(product.mallTagNo);
	}
	 
	// ***  æ ¹æ“šåº«å­˜è³‡è¨Šç”Ÿæˆç‹€æ…‹ (è–°å¦¤ä¿®) ***//
	function generateStatusInfo(proIsmarket, proStatus, stockInfo) {
	    let statusInfo = {
	        displayText: 'ç‹€æ…‹æœªçŸ¥',
	        statusClass: 'badge bg-secondary',
	        stockText: 'åº«å­˜ç‹€æ…‹æœªçŸ¥',
	        stockClass: 'text-muted',
	        stockCount: 'æŸ¥è©¢ä¸­...',
	        
	        canPurchase: false,
	        buttonText: 'ç„¡æ³•è³¼è²·'
	    };
	    
	    // å¦‚æœæœ‰åº«å­˜è³‡è¨Šï¼Œä½¿ç”¨çœŸå¯¦è³‡æ–™
	    if (stockInfo && stockInfo.stock !== undefined) {
	        const realStock = stockInfo.stock;
	        const stockSource = stockInfo.stockSource || 'è³‡æ–™åº«';
	        
	        if (proIsmarket === '0' || proIsmarket === 0) {
	            // ä¸Šæ¶å•†å“
	            if (realStock > 0) {
	                if (proStatus === 'é è³¼ä¸­' || proStatus === 'é è³¼') {
	                    statusInfo = {
	                        displayText: 'é–‹æ”¾é è³¼',
	                        statusClass: 'badge bg-warning text-dark',
	                        stockText: 'é è³¼å•†å“ï¼Œç™¼å”®å¾Œå‡ºè²¨',
	                        stockClass: 'text-warning',
	                        stockCount: `${realStock} ä»¶`,
	                        
	                        canPurchase: true,
	                        buttonText: 'ç«‹å³é è³¼'
	                    };
	                } else {
	                    statusInfo = {
	                        displayText: 'ç¾è²¨ä¾›æ‡‰',
	                        statusClass: 'badge bg-success',
	                        stockText: realStock <= 10 ? 'åº«å­˜åä½ï¼Œæ¬²è³¼å¾é€Ÿ' : 'æœ‰ç¾è²¨ï¼Œç«‹å³ç™¼è²¨',
	                        stockClass: realStock <= 10 ? 'text-warning' : 'text-success',
	                        stockCount: `${realStock} ä»¶`,
	                        
	                        canPurchase: true,
	                        buttonText: 'åŠ å…¥è³¼ç‰©è»Š'
	                    };
	                }
	            } else {
	                // ç„¡åº«å­˜
	                statusInfo = {
	                    displayText: 'æš«æ™‚ç¼ºè²¨',
	                    statusClass: 'badge bg-danger',
	                    stockText: 'å•†å“æš«æ™‚ç¼ºè²¨',
	                    stockClass: 'text-danger',
	                    stockCount: '0 ä»¶',
	                    
	                    canPurchase: false,
	                    buttonText: 'æš«æ™‚ç¼ºè²¨'
	                };
	            }
	        } else {
	            // ä¸‹æ¶å•†å“
	            statusInfo = {
	                displayText: 'æš«åœè²©å”®',
	                statusClass: 'badge bg-danger',
	                stockText: 'å•†å“æš«æ™‚ä¸‹æ¶',
	                stockClass: 'text-danger',
	                stockCount: '0 ä»¶',
	                
	                canPurchase: false,
	                buttonText: 'æš«åœè²©å”®'
	            };
	        }
	    } else {
	        // ç„¡æ³•å–å¾—åº«å­˜è³‡è¨Šï¼Œä½¿ç”¨é è¨­é‚è¼¯
	        console.warn('âš ï¸ ç„¡åº«å­˜è³‡è¨Šï¼Œä½¿ç”¨é è¨­é¡¯ç¤º');
	        
	        if (proIsmarket === '0' || proIsmarket === 0) {
	            statusInfo = {
	                displayText: proStatus || 'å·²ç™¼å”®',
	                statusClass: 'badge bg-success',
	                stockText: 'å•†å“å¯è³¼è²·',
	                stockClass: 'text-success',
	                stockCount: 'æŸ¥è©¢ä¸­...',
	                
	                canPurchase: true,
	                buttonText: 'åŠ å…¥è³¼ç‰©è»Š'
	            };
	        } else {
	            statusInfo = {
	                displayText: 'æš«åœè²©å”®',
	                statusClass: 'badge bg-danger',
	                stockText: 'å•†å“æš«æ™‚ä¸‹æ¶',
	                stockClass: 'text-danger',
	                stockCount: '0 ä»¶',
	                
	                canPurchase: false,
	                buttonText: 'æš«åœè²©å”®'
	            };
	        }
	    }
	    
	    return statusInfo;
	}

	 
	 
	/**
	 * é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
	 */
	function showProductError(message) {
	    const container = document.getElementById('dynamic-content-container');
	    container.innerHTML = `
	        <div class="text-center py-5">
	            <i class="bi bi-exclamation-triangle display-1 text-danger"></i>
	            <h3 class="mt-3">è¼‰å…¥å¤±æ•—</h3>
	            <p class="text-muted">${message}</p>
	            <div class="mt-4">
	                <button class="btn btn-primary me-2" onclick="location.reload()">
	                    <i class="bi bi-arrow-clockwise"></i> é‡è©¦
	                </button>
	                <a href="/front-end/shopsys/product.html" class="btn btn-outline-secondary me-2">
	                    <i class="bi bi-grid"></i> å•†å“åˆ—è¡¨
	                </a>
	                <a href="/front-end/shopsys/shopindex.html" class="btn btn-outline-primary">
	                    <i class="bi bi-house"></i> å•†åŸé¦–é 
	                </a>
	            </div>
	        </div>
	    `;
	}

	
	//*** è™•ç†åŠ å…¥è³¼ç‰©è»Š (è–°å¦¤æœ‰åŠ å…¥å¯¦éš›å‘¼å«å¾Œç«¯ APIï¼ŒåŸæœ¬åªæœ‰é¡¯ç¤ºæç¤ºè¨Šæ¯)*** //
	async function handleAddToCart(productId) {
    console.log('åŠ å…¥è³¼ç‰©è»Š:', productId);
    
    // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
    const jwt = localStorage.getItem('jwt');
    if (!jwt) {
        showToast('è«‹å…ˆç™»å…¥æœƒå“¡ï¼', 'warning');
        // æœªç™»å…¥è·³è½‰åˆ°ç™»å…¥é é¢
        window.location.href = '/front-end/mem/MemberLogin.html';
        return;
    }
    
    try {
        // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        showToast('æ­£åœ¨åŠ å…¥è³¼ç‰©è»Š...', 'info');
        
        // å‘¼å«åŠ è³¼ç‰©è»Š API
        const response = await fetch('/api/cart/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'Authorization': 'Bearer ' + jwt
            },
            body: `proNo=${productId}&proNum=1`  // é è¨­æ•¸é‡ç‚º 1
        });
        
        if (response.ok) {
            const cartData = await response.json();
            console.log('åŠ è³¼ç‰©è»ŠæˆåŠŸ:', cartData);
            showToast('å•†å“å·²åŠ å…¥è³¼ç‰©è»Šï¼', 'success');
            
            // å¯é¸ï¼šæ›´æ–°é é¢ä¸Šçš„è³¼ç‰©è»Šæ•¸é‡é¡¯ç¤º
            updateCartBadge();
            
        } else {
            const errorText = await response.text();
            console.error('åŠ è³¼ç‰©è»Šå¤±æ•—:', response.status, errorText);
            
            if (response.status === 401) {
                showToast('ç™»å…¥å·²éæœŸï¼Œè«‹é‡æ–°ç™»å…¥ï¼', 'warning');
            } else {
                showToast('åŠ å…¥è³¼ç‰©è»Šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ï¼', 'error');
            }
        }
        
    	} catch (error) {
        console.error('ç¶²è·¯éŒ¯èª¤:', error);
        showToast('ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ï¼', 'error');
    	}
    
	}

	
	//*** è–°å¦¤æ–°å¢-æ›´æ–°è³¼ç‰©è»Šæ•¸é‡é¡¯ç¤ºï¼ˆå¦‚æœé é¢æœ‰è³¼ç‰©è»Šæ•¸é‡ï¼‰*** //
	function updateCartBadge() {
    // é€™å€‹å‡½æ•¸å¯ä»¥ç”¨ä¾†æ›´æ–° header ä¸­çš„è³¼ç‰©è»Šæ•¸é‡
    // å¦‚æœ header æœ‰è³¼ç‰©è»Šæ•¸é‡é¡¯ç¤ºçš„è©±
    console.log('å¯ä»¥åœ¨é€™è£¡æ›´æ–°è³¼ç‰©è»Šæ•¸é‡é¡¯ç¤º');
	}
	
	


	/**
	 * è™•ç†åŠ å…¥æœ€æ„›
	 */
	function handleAddToFavorite(productId) {
	    console.log('åŠ å…¥æœ€æ„›:', productId);
	    showToast('å·²åŠ å…¥æˆ‘çš„æœ€æ„›ï¼', 'info');
	}

	/**
	 * é¡¯ç¤ºæç¤ºè¨Šæ¯
	 */
	function showToast(message, type = 'success') {
	    const colors = {
	        success: '#28a745',
	        info: '#007bff',
	        warning: '#ffc107',
	        error: '#dc3545'
	    };
	    
	    const toast = document.createElement('div');
	    toast.style.cssText = `
	        position: fixed; top: 20px; right: 20px; 
	        background: ${colors[type] || colors.success}; color: white;
	        padding: 12px 20px; border-radius: 8px; z-index: 9999; 
	        font-weight: 500; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
	        animation: slideIn 0.3s ease;
	    `;
	    toast.textContent = message;
	    
	    // æ·»åŠ ç°¡å–®å‹•ç•«
	    const style = document.createElement('style');
	    style.textContent = `
	        @keyframes slideIn {
	            from { transform: translateX(100%); opacity: 0; }
	            to { transform: translateX(0); opacity: 1; }
	        }
	    `;
	    if (!document.getElementById('toast-animation')) {
	        style.id = 'toast-animation';
	        document.head.appendChild(style);
	    }
	    
	    document.body.appendChild(toast);
	    
	    setTimeout(() => {
	        if (toast.parentNode) {
	            toast.parentNode.removeChild(toast);
	        }
	    }, 3000);
	}

	/**
	 * æ ¼å¼åŒ–åƒ¹æ ¼
	 */
	function formatPrice(price) {
	    return new Intl.NumberFormat('zh-TW').format(price);
	}
	
	/**
	 * è¼‰å…¥å•†å“åœ–ç‰‡è¼ªæ’­
	 */
	async function loadProductImageCarousel(productId) {
	    try {
	        console.log('ğŸ–¼ï¸ é–‹å§‹è¼‰å…¥å•†å“åœ–ç‰‡è¼ªæ’­ï¼Œç”¢å“ID:', productId);
	        
	        const apiBaseUrl = `${location.origin}/api`;
	        const imageListUrl = `${apiBaseUrl}/productimg/search/${productId}`;
	        
	        // å–å¾—åœ–ç‰‡åˆ—è¡¨
	        const response = await fetch(imageListUrl);
	        
	        if (!response.ok) {
	            throw new Error(`åœ–ç‰‡ API è«‹æ±‚å¤±æ•—: ${response.status}`);
	        }
	        
	        const result = await response.json();
	        console.log('ğŸ“· åœ–ç‰‡ API å›æ‡‰:', result);
	        
	        if (result.success && result.data && result.data.length > 0) {
	            // æœ‰åœ–ç‰‡è³‡æ–™ï¼Œå»ºç«‹è¼ªæ’­
	            buildImageCarousel(result.data);
	        } else {
	            // æ²’æœ‰åœ–ç‰‡è³‡æ–™ï¼Œé¡¯ç¤ºé è¨­å…§å®¹
	            showNoImagesMessage();
	        }
	        
	    } catch (error) {
	        console.error('âŒ è¼‰å…¥åœ–ç‰‡è¼ªæ’­å¤±æ•—:', error);
	        showImageLoadError(productId);
	    }
	}

	/**
	 * å»ºç«‹åœ–ç‰‡è¼ªæ’­
	 */
	function buildImageCarousel(imageList) {
	    console.log('ğŸ  å»ºç«‹è¼ªæ’­ï¼Œåœ–ç‰‡æ•¸é‡:', imageList.length);
	    
	    const carouselInner = document.getElementById('carouselInner');
	    const carouselIndicators = document.getElementById('carouselIndicators');
	    
	    if (!carouselInner || !carouselIndicators) {
	        console.error('æ‰¾ä¸åˆ°è¼ªæ’­å®¹å™¨å…ƒç´ ');
	        return;
	    }
	    
	    // æ¸…ç©ºå®¹å™¨
	    carouselInner.innerHTML = '';
	    carouselIndicators.innerHTML = '';
	    
	    // å»ºç«‹è¼ªæ’­é …ç›®
	    imageList.forEach((image, index) => {
	        const isActive = index === 0 ? 'active' : '';
	        
	        // å»ºç«‹è¼ªæ’­é …ç›®å®¹å™¨
	        const carouselItem = document.createElement('div');
	        carouselItem.className = `carousel-item ${isActive}`;
	        
	        // å»ºç«‹åœ–ç‰‡å…ƒç´ 
	        const img = document.createElement('img');
	        img.src = image.imageUrl;
	        img.className = 'd-block w-100';
	        img.alt = `éŠæˆ²ç•«é¢ ${index + 1}`;
	        
	        // æ‡‰ç”¨ä½ è¦çš„ CSS æ¨£å¼
	        img.style.cssText = `
	            height: 500px;
	            object-fit: contain;
	            object-position: center;
	            border-radius: 8px;
	            background-color: #f8f9fa;
	        `;
	        
	        // æ·»åŠ åœ–ç‰‡è¼‰å…¥äº‹ä»¶
	        img.onload = function() {
	            console.log(`âœ… åœ–ç‰‡ ${index + 1} è¼‰å…¥æˆåŠŸ:`, image.imageUrl);
	        };
	        
	        img.onerror = function() {
	            console.error(`âŒ åœ–ç‰‡ ${index + 1} è¼‰å…¥å¤±æ•—:`, image.imageUrl);
	            // ä½¿ç”¨ base64 ç·¨ç¢¼çš„é è¨­åœ–ç‰‡ï¼Œé¿å…å¤–éƒ¨ç¶²è·¯å•é¡Œ
	            this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjUwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOWZhIi8+CiAgPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIyNCIgZmlsbD0iIzZjNzU3ZCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuWcluePh+i8ieWFpeWkseaVlzwvdGV4dD4KICA8L3N2Zz4K';
	            console.log('ğŸ”„ å·²åˆ‡æ›åˆ°é è¨­åœ–ç‰‡');
	        };
	        
	        // å»ºç«‹ç©ºçš„ caption å®¹å™¨ï¼ˆä¿æŒçµæ§‹ä½†ä¸é¡¯ç¤ºæ–‡å­—ï¼‰
	        const caption = document.createElement('div');
	        caption.className = 'carousel-caption d-none d-md-block';
	        
	        // çµ„åˆå…ƒç´ 
	        carouselItem.appendChild(img);
	        carouselItem.appendChild(caption);
	        carouselInner.appendChild(carouselItem);
	        
	        // å»ºç«‹æŒ‡ç¤ºå™¨
	        const indicator = document.createElement('button');
	        indicator.type = 'button';
	        indicator.setAttribute('data-bs-target', '#productImageCarousel');
	        indicator.setAttribute('data-bs-slide-to', index.toString());
	        indicator.setAttribute('aria-label', `Slide ${index + 1}`);
	        if (index === 0) {
	            indicator.className = 'active';
	            indicator.setAttribute('aria-current', 'true');
	        }
	        carouselIndicators.appendChild(indicator);
	    });
	    
	    // å¦‚æœåªæœ‰ä¸€å¼µåœ–ç‰‡ï¼Œéš±è—æ§åˆ¶æŒ‰éˆ•å’ŒæŒ‡ç¤ºå™¨
	    if (imageList.length === 1) {
	        hideCarouselControls();
	    } else {
	        showCarouselControls();
	    }
	    
	    console.log('âœ… è¼ªæ’­å»ºç«‹å®Œæˆï¼Œå…±', imageList.length, 'å¼µåœ–ç‰‡');
	    
	    // é‡æ–°åˆå§‹åŒ– Bootstrap è¼ªæ’­
	    try {
	        const carouselElement = document.getElementById('productImageCarousel');
	        if (carouselElement && window.bootstrap) {
	            new bootstrap.Carousel(carouselElement);
	            console.log('ğŸ  Bootstrap è¼ªæ’­åˆå§‹åŒ–æˆåŠŸ');
	        }
	    } catch (error) {
	        console.warn('âš ï¸ Bootstrap è¼ªæ’­åˆå§‹åŒ–å¤±æ•—:', error);
	    }
	}

	/**
	 * é¡¯ç¤ºè¼ªæ’­æ§åˆ¶å…ƒç´ 
	 */
	function showCarouselControls() {
	    const carousel = document.getElementById('productImageCarousel');
	    if (carousel) {
	        const prevBtn = carousel.querySelector('.carousel-control-prev');
	        const nextBtn = carousel.querySelector('.carousel-control-next');
	        const indicators = carousel.querySelector('.carousel-indicators');
	        
	        if (prevBtn) prevBtn.style.display = 'block';
	        if (nextBtn) nextBtn.style.display = 'block';
	        if (indicators) indicators.style.display = 'flex';
	    }
	}

	/**
	 * éš±è—è¼ªæ’­æ§åˆ¶å…ƒç´ ï¼ˆç•¶åªæœ‰ä¸€å¼µåœ–ç‰‡æ™‚ï¼‰
	 */
	function hideCarouselControls() {
	    const carousel = document.getElementById('productImageCarousel');
	    if (carousel) {
	        const prevBtn = carousel.querySelector('.carousel-control-prev');
	        const nextBtn = carousel.querySelector('.carousel-control-next');
	        const indicators = carousel.querySelector('.carousel-indicators');
	        
	        if (prevBtn) prevBtn.style.display = 'none';
	        if (nextBtn) nextBtn.style.display = 'none';
	        if (indicators) indicators.style.display = 'none';
	    }
	}

	/**
	 * é¡¯ç¤ºç„¡åœ–ç‰‡è¨Šæ¯
	 */
	function showNoImagesMessage() {
	    console.log('ğŸ“­ æ²’æœ‰æ‰¾åˆ°å•†å“åœ–ç‰‡');
	    
	    const carouselInner = document.getElementById('carouselInner');
	    const carouselIndicators = document.getElementById('carouselIndicators');
	    
	    if (carouselInner) {
	        carouselInner.innerHTML = `
	            <div class="carousel-item active">
	                <div class="d-flex justify-content-center align-items-center" style="height: 500px; background-color: #f8f9fa; border-radius: 8px;">
	                    <div class="text-center">
	                        <i class="bi bi-image display-1 text-muted"></i>
	                        <h5 class="mt-3 text-muted">æš«ç„¡éŠæˆ²ç•«é¢</h5>
	                        <p class="text-muted">ç›®å‰æ²’æœ‰ä¸Šå‚³éŠæˆ²æˆªåœ–</p>
	                    </div>
	                </div>
	            </div>
	        `;
	    }
	    
	    if (carouselIndicators) {
	        carouselIndicators.innerHTML = '';
	    }
	    
	    hideCarouselControls();
	}

	/**
	 * é¡¯ç¤ºåœ–ç‰‡è¼‰å…¥éŒ¯èª¤
	 */
	function showImageLoadError(productId) {
	    console.log('âŒ åœ–ç‰‡è¼‰å…¥ç™¼ç”ŸéŒ¯èª¤');
	    
	    const carouselInner = document.getElementById('carouselInner');
	    
	    if (carouselInner) {
	        carouselInner.innerHTML = `
	            <div class="carousel-item active">
	                <div class="d-flex justify-content-center align-items-center" style="height: 500px; background-color: #f8f9fa; border-radius: 8px;">
	                    <div class="text-center">
	                        <i class="bi bi-exclamation-triangle display-1 text-warning"></i>
	                        <h5 class="mt-3 text-muted">è¼‰å…¥å¤±æ•—</h5>
	                        <p class="text-muted">ç„¡æ³•è¼‰å…¥éŠæˆ²ç•«é¢ï¼Œè«‹ç¨å¾Œå†è©¦</p>
	                        <button class="btn btn-outline-primary btn-sm" onclick="loadProductImageCarousel(${productId})">
	                            <i class="bi bi-arrow-clockwise me-1"></i>é‡è©¦
	                        </button>
	                    </div>
	                </div>
	            </div>
	        `;
	    }
	    
	    hideCarouselControls();
	}

	// æ·»åŠ è¼ªæ’­çš„ CSS æ¨£å¼
	function addCarouselStyles() {
	    const style = document.createElement('style');
	    style.textContent = `
	        #productImageCarousel {
	            border-radius: 12px;
	            overflow: hidden;
	            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
	        }
	        
	        #productImageCarousel .carousel-item img {
	            transition: transform 0.3s ease;
	        }
	        
	        #productImageCarousel .carousel-item:hover img {
	            transform: scale(1.02);
	        }
	        
	        #productImageCarousel .carousel-control-prev,
	        #productImageCarousel .carousel-control-next {
	            background: rgba(0,0,0,0.3);
	            border-radius: 50%;
	            width: 40px;
	            height: 40px;
	            top: 50%;
	            transform: translateY(-50%);
	        }
	        
	        #productImageCarousel .carousel-control-prev {
	            left: 15px;
	        }
	        
	        #productImageCarousel .carousel-control-next {
	            right: 15px;
	        }
	        
	        #productImageCarousel .carousel-indicators {
	            bottom: 15px;
	        }
	        
	        #productImageCarousel .carousel-indicators button {
	            width: 12px;
	            height: 12px;
	            border-radius: 50%;
	            margin: 0 4px;
	        }
	        
	        .game-gallery h5 {
	            color: #495057;
	            font-weight: 600;
	            margin-bottom: 1rem;
	        }
	    `;
	    
	    if (!document.getElementById('carousel-styles')) {
	        style.id = 'carousel-styles';
	        document.head.appendChild(style);
	    }
	}

	document.addEventListener('DOMContentLoaded', function() {
	    addCarouselStyles();
	});
	</script>
	
	
	

</body>
</html>