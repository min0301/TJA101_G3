<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åƒç´ éƒ¨è½ - å•†åŸ - æ‰€æœ‰ç”¢å“</title>
<meta name="description" content="åƒç´ éƒ¨è½, Pixel Tribe, è™›æ“¬éŠæˆ²å•†åŸ - æ‰€æœ‰ç”¢å“">
<meta name="keywords" content="éŠæˆ²å•†åŸ, é›»ç«¶, éŠæˆ²ç©å®¶, å„ªæƒ æ´»å‹•, å•†å“è³¼è²·, æ‰€æœ‰ç”¢å“">
<meta name="robots" content="all,follow">
<script src="/js/dynamicHeaderInfo.js"></script>
<script>
	//Check local storage
	let localS = localStorage.getItem('theme')
	themeToSet = localS

	// If local storage is not set, we check the OS preference
	if (!localS) {
		themeToSet = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
	}

	//Set the correct theme
	document.documentElement.setAttribute('data-theme', themeToSet)
</script>

<!-- çµ±ä¸€ç”¨çµ•å°è·¯ç¶“  -->
<link rel="stylesheet" href="/assets/vendors/bootstrap/bootstrap.min.css">
<link rel="stylesheet" href="/assets/vendors/bootstrap-icons/bootstrap-icons.css">
<link rel="stylesheet" href="/assets/vendors/simplebar/simplebar.min.css">
<link rel="stylesheet" href="/assets/vendors/aos/aos.css">
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet" href="/assets/css/responsive.css">
<link rel="stylesheet" href="/assets/css/custom-style.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Karla&display=swap" rel="stylesheet">

</head>

<body>
	<div class="switcher switcher-show" id="theme-switcher">
		<i id="switcher-icon" class="bi bi-moon"></i>
	</div>

	<a href="#" id="back-to-top"></a>

	<div class="vine-wrapper">

		<div id="header-placeholder"></div>

		<section class="vine-hero-2 bg-img-1">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<div class="hero-content" data-aos="fade-down" data-aos-easing="linear">
							<h1>åƒç´ éƒ¨è½(Pixel Tribe)</h1>
							<p>éŠæˆ²æ„›å¥½è€…çš„èšé›†åœ° - æ‰€æœ‰ç”¢å“</p>
						</div>
					</div>
				</div>
			</div>
		</section>

		<section class="vine-main">
			<div class="container">
				<div class="row">
					<div class="col-lg-3 pe-lg-3 border-end">
						<div class="position-sticky" style="top: 100px;">
							<div class="mall-category-sidebar">
								<h5 class="mb-3">å¹³å°åˆ†é¡</h5>
								<div id="malltag-list">
									<!-- åˆ†é¡é …ç›®æœƒç”± malltag.js å‹•æ…‹è¼‰å…¥ -->
								</div>
								
								<!-- è¿”å›å•†åŸé¦–é æŒ‰éˆ• <<ä¿®æ­£çµ±ä¸€ç”¨å°è·¯å¾‘>> -->
								<div class="mt-4">
									<a href="/front-end/shopsys/shopindex.html" class="btn btn-outline-primary w-100">
										<i class="bi bi-house me-2"></i>è¿”å›å•†åŸé¦–é 
									</a>
								</div>
							</div>
						</div>
					</div>

					<div class="col-lg-9 ps-lg-5">
						<div id="dynamic-content-container">
							<!-- å•†å“åˆ—è¡¨æœƒç”± malltag.js å‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
						</div>
					</div>
				</div>
			</div>
		</section>
		
		<div id="footer-placeholder"></div>

	</div>
	
	<!-- ä¿®æ­£çµ±ä¸€ç”¨å°è·¯å¾‘ -->
	<script src="/assets/vendors/jquery/jquery.min.js"></script>
	<script src="/assets/vendors/bootstrap/bootstrap.bundle.js"></script>
	<script src="/assets/vendors/popper/popper.min.js"></script>
	<script src="/assets/vendors/simplebar/simplebar.min.js"></script>
	<script src="/assets/vendors/aos/aos.js"></script>
	<script src="/assets/js/main.js"></script>
	<script src="/assets/js/global-loader.js"></script>
	
	<!-- ä¿®æ­£çµ±ä¸€ç”¨å°è·¯å¾‘ -->
	<script src="/front-end/shopsys/malltag.js"></script>
	<!-- <script src="/front-end/shopsysproductDetail.js"></script> -->
	
	<script>
	//*** é é¢åˆå§‹åŒ– - ç°¡åŒ–ç‰ˆï¼Œè®“ malltag.js å®Œå…¨æ¥ç®¡ ***//
	
	//*** é é¢åˆå§‹åŒ– - é©é…çµ„å“¡çš„æ··æ·†çµæ§‹ ***//
	document.addEventListener('DOMContentLoaded', function() {
    console.log('=== å•†å“é é¢é–‹å§‹åˆå§‹åŒ– ===');
    
    setTimeout(function() {
        try {
            // æª¢æŸ¥ URL åƒæ•¸
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            
            console.log('ç•¶å‰ URL åƒæ•¸:', {
                productId: productId,
                fullUrl: window.location.href,
                pathname: window.location.pathname
            });
            
            if (productId) {
                console.log('ğŸ“± æœ‰å•†å“IDï¼Œé¡¯ç¤ºå•†å“è©³æƒ…');
                initProductDetailMode(productId);
            } else {
                console.log('ğŸ“‹ æ²’æœ‰å•†å“IDï¼Œé¡¯ç¤ºå•†å“åˆ—è¡¨');
                initProductListMode();
            }
            
        } catch (error) {
            console.error('âŒ é é¢åˆå§‹åŒ–éŒ¯èª¤:', error);
	        }
	    }, 300);
	});
	
	// *** åˆå§‹åŒ–å•†å“è©³æƒ…æ¨¡å¼
	async function initProductDetailMode(productId) {
	    console.log('ğŸ”§ åˆå§‹åŒ–å•†å“è©³æƒ…æ¨¡å¼ï¼Œå•†å“ID:', productId);
	    
	    try {
	        // 1. å…ˆåˆå§‹åŒ–å·¦å´åˆ†é¡
	        await initLeftSidebar();
	        
	        // 2. å†è¼‰å…¥å•†å“è©³æƒ…
	        await showProductDetail(productId);
	        
	        console.log('âœ… å•†å“è©³æƒ…æ¨¡å¼åˆå§‹åŒ–å®Œæˆ');
	        
	    } catch (error) {
	        console.error('âŒ å•†å“è©³æƒ…æ¨¡å¼åˆå§‹åŒ–å¤±æ•—:', error);
	        showProductError('åˆå§‹åŒ–å¤±æ•—ï¼š' + error.message);
	    }
	}
	
	/**
	 * åˆå§‹åŒ–å•†å“åˆ—è¡¨æ¨¡å¼
	 */
	async function initProductListMode() {
	    console.log('ğŸ”§ åˆå§‹åŒ–å•†å“åˆ—è¡¨æ¨¡å¼');
	    
	    try {
	        if (window.mallTagManager && typeof window.mallTagManager.init === 'function') {
	            await window.mallTagManager.init();
	        } else {
	            console.warn('MallTagManager æœªæ‰¾åˆ°ï¼Œå˜—è©¦æ‰‹å‹•åˆå§‹åŒ–...');
	            setTimeout(async () => {
	                if (window.mallTagManager) {
	                    await window.mallTagManager.init();
	                }
	            }, 500);
	        }
	        
	        console.log('âœ… å•†å“åˆ—è¡¨æ¨¡å¼åˆå§‹åŒ–å®Œæˆ');
	        
	    } catch (error) {
	        console.error('âŒ å•†å“åˆ—è¡¨æ¨¡å¼åˆå§‹åŒ–å¤±æ•—:', error);
	    }
	}
	
	/**
	 * åˆå§‹åŒ–å·¦å´åˆ†é¡å´é‚Šæ¬„
	 */
	async function initLeftSidebar() {
	    console.log('ğŸ·ï¸ é–‹å§‹åˆå§‹åŒ–å·¦å´åˆ†é¡å´é‚Šæ¬„...');
	    
	    if (window.MallTagManager && !window.sidebarMallTagManager) {
	        try {
	            // å‰µå»ºå°ˆé–€ç”¨æ–¼å´é‚Šæ¬„çš„å¯¦ä¾‹
	            window.sidebarMallTagManager = new window.MallTagManager();
	            
	            // ä¿®æ”¹å…¶è¡Œç‚ºï¼šåªé¡¯ç¤ºåˆ†é¡ï¼Œä¸æ§åˆ¶å³å´å…§å®¹
	            window.sidebarMallTagManager.displayProducts = function() {
	                console.log('ğŸš« å´é‚Šæ¬„æ¨¡å¼ï¼šé˜»æ­¢æ§åˆ¶å³å´å•†å“é¡¯ç¤º');
	            };
	            
	            // ä¿®æ”¹é»æ“Šè¡Œç‚º
	            window.sidebarMallTagManager.handleMalltagClick = function(malltagItem) {
	                const tagId = malltagItem.dataset.malltagId;
	                const tagName = malltagItem.dataset.malltagName;
	                
	                console.log(`ğŸ”— å´é‚Šæ¬„åˆ†é¡é»æ“Š: ${tagName} (ID: ${tagId})`);
	                
	                if (tagId === 'all') {
	                    window.location.href = '/front-end/shopsys/product.html';
	                } else {
	                    window.location.href = `/front-end/shopsys/product.html?category=${tagId}`;
	                }
	            };
	            
	            await window.sidebarMallTagManager.init();
	            console.log('âœ… å·¦å´åˆ†é¡å´é‚Šæ¬„åˆå§‹åŒ–å®Œæˆ');
	            
	        } catch (error) {
	            console.error('âŒ å·¦å´åˆ†é¡å´é‚Šæ¬„åˆå§‹åŒ–å¤±æ•—:', error);
	        }
	    } else if (!window.MallTagManager) {
	        console.warn('âš ï¸ MallTagManager é¡åˆ¥æœªæ‰¾åˆ°');
	    }
	}
	
	

	// *** é¡¯ç¤ºå•†å“è©³æƒ… - æ•´åˆåº«å­˜ API (è–°å¦¤ä¿®) ***//
	async function showProductDetail(productId) {
    	try {
        	console.log('é–‹å§‹è¼‰å…¥å•†å“è©³æƒ…ï¼ŒID:', productId);
        
        	// é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        	const container = document.getElementById('dynamic-content-container');
        	if (!container) {
            	console.error('æ‰¾ä¸åˆ° dynamic-content-container');
            	return;
        	}
        
        	container.innerHTML = `
            	<div class="text-center py-5">
                	<div class="spinner-border text-primary" role="status"></div>
                	<h4 class="mt-3">è¼‰å…¥å•†å“è³‡è¨Šä¸­...</h4>
                	<p class="text-muted">è«‹ç¨å€™</p>
            	</div>
		        `;
		        
		        // ä½¿ç”¨å’Œ productList.js ç›¸åŒçš„ API
		        const apiBaseUrl = `${location.origin}/api`;
		        const apiUrl = `${apiBaseUrl}/product/searchall?proIsMarket=0`;
		        
		        console.log('è«‹æ±‚å•†å“ API:', apiUrl);
		        
		        const response = await fetch(apiUrl);
		        if (!response.ok) {
		            throw new Error(`HTTP error! status: ${response.status}`);
		        }
		
		        const products = await response.json();
		        console.log('è¼‰å…¥å•†å“åˆ—è¡¨:', products.length, 'é …');
		        
		        // å°‹æ‰¾ç›®æ¨™å•†å“
		        const product = products.find(p => 
		            String(p.id) === String(productId) || 
		            String(p.proNo) === String(productId)
		        );
		
		        if (!product) {
		            throw new Error(`æ‰¾ä¸åˆ°å•†å“ ID: ${productId}`);
		        }
		
		        console.log('æ‰¾åˆ°ç›®æ¨™å•†å“:', product);
		        
		        // æ–°å¢ï¼šè¼‰å…¥åº«å­˜è³‡è¨Š
		        let stockInfo = null;
		        try {
		            console.log('é–‹å§‹æŸ¥è©¢åº«å­˜è³‡è¨Š...');
		            const stockResponse = await fetch(`${apiBaseUrl}/cart/stock/${productId}`, {
		                headers: {
		                    'Authorization': 'Bearer ' + localStorage.getItem('jwt'),
		                    'Content-Type': 'application/json'
		                }
		            });
		            
		            if (stockResponse.ok) {
		                stockInfo = await stockResponse.json();
		                console.log('åº«å­˜è³‡è¨Šè¼‰å…¥æˆåŠŸ:', stockInfo);
		            } else {
		                console.warn('åº«å­˜ API å›æ‡‰å¤±æ•—:', stockResponse.status);
		            }
		        } catch (stockError) {
		            console.warn('ç„¡æ³•å–å¾—åº«å­˜è³‡è¨Š:', stockError);
		        }
		        
		        // é¡¯ç¤ºå•†å“è©³æƒ…ï¼ˆåŒ…å«åº«å­˜ï¼‰
		        displayProductDetailWithStock(product, stockInfo);
		        
		    } catch (error) {
		        console.error('è¼‰å…¥å•†å“è©³æƒ…å¤±æ•—:', error);
		        showProductError(error.message);
		    }
		}
	
	
	
	// å•†å“å¹³å°é¡¯ç¤º ä¿®æ­£
	// é«˜äº®å°æ‡‰çš„å·¦å´æ¨™ç±¤
	function highlightCorrespondingTag(mallTagNo) {
	    try {
	        console.log('ğŸ¯ å˜—è©¦é«˜äº®æ¨™ç±¤:', mallTagNo);
	        
	        // æ¸…é™¤æ‰€æœ‰æ¨™ç±¤çš„é«˜äº®
	        const allTags = document.querySelectorAll('.malltag-item, [data-malltag-id]');
	        allTags.forEach(tag => {
	            tag.classList.remove('active', 'malltag-active');
	        });
	        
	        // ç¢ºå®šè¦é«˜äº®çš„æ¨™ç±¤ID
	        let tagId;
	        if (mallTagNo && mallTagNo.id) {
	            tagId = mallTagNo.id;
	        } else if (typeof mallTagNo === 'number') {
	            tagId = mallTagNo;
	        }
	        
	        if (tagId) {
	            const targetTag = document.querySelector(`[data-malltag-id="${tagId}"]`);
	            if (targetTag) {
	                targetTag.classList.add('active');
	                console.log(`âœ… å·²é«˜äº®æ¨™ç±¤ ID: ${tagId}`);
	            }
	        }
	        
	    } catch (error) {
	        console.error('âŒ é«˜äº®æ¨™ç±¤å¤±æ•—:', error);
	    }
	}


	
	 

	
	
	// ***  é¡¯ç¤ºå•†å“è©³æƒ…å…§å®¹ åŒ…å«åº«å­˜ (è–°å¦¤ä¿®) ***//
	function displayProductDetailWithStock(product, stockInfo) {
		// åŠ å…¥é™¤éŒ¯è³‡è¨Š
	    console.log('ğŸ” æª¢æŸ¥å•†å“æè¿°è³‡æ–™:');
	    console.log('product.proDetails:', product.proDetails);
	    console.log('product.proInclude:', product.proInclude);
	    console.log('å®Œæ•´å•†å“ç‰©ä»¶:', product);

		
	    const container = document.getElementById('dynamic-content-container');
	    
	    // å¹³å°åç¨±é‚è¼¯
	    let platformName = 'æ¸¬è©¦å¹³å°';
	    
	    if (product.mallTagNo) {
	        if (typeof product.mallTagNo === 'object' && product.mallTagNo.mallTagName) {
	            platformName = product.mallTagNo.mallTagName;
	        } else if (typeof product.mallTagNo === 'number') {
	            const platformMap = {
	                1: 'Steam',
	                2: 'PlayStation',
	                3: 'Xbox',
	                4: 'Nintendo Switch',
	                5: 'Epic Games Store'
	            };
	            platformName = platformMap[product.mallTagNo] || `å¹³å° ${product.mallTagNo}`;
	        }
	    }
	    
	    const productDescription = getProductDescription(product);
	    
	    // æ•´åˆåº«å­˜é‚è¼¯
	    const proIsmarket = product.proIsmarket;
	    const proStatus = product.proStatus;
	    
	    console.log('å•†å“ä¸Šæ¶ç‹€æ…‹ (proIsmarket):', proIsmarket);
	    console.log('å•†å“ç‹€æ…‹ (proStatus):', proStatus);
	    console.log('åº«å­˜è³‡è¨Š:', stockInfo);
	    
	    // æ ¹æ“šåº«å­˜è³‡è¨Šç”Ÿæˆç‹€æ…‹
	    let statusInfo = generateStatusInfo(proIsmarket, proStatus, stockInfo);
	    
	    const productId = product.id || product.proNo;
	    const apiBaseUrl = `${location.origin}/api`;
	    const imageUrl = `${apiBaseUrl}/product/cover/${productId}`;
	    
	    // æ›´æ–°é é¢æ¨™é¡Œ
	    document.title = `${product.proName} - åƒç´ éƒ¨è½`;
	    
	    // æ›´æ–° hero å€åŸŸæ¨™é¡Œ
	    const heroContent = document.querySelector('.hero-content p');
	    if (heroContent) {
	        heroContent.textContent = `å•†å“è©³æƒ… - ${product.proName}`;
	    }
	    
	    // é¡¯ç¤ºå®Œæ•´çš„å•†å“è©³æƒ…ï¼ˆåŒ…å«åº«å­˜ï¼‰
	    container.innerHTML = `
	        <div class="card shadow-sm border-0">
	            <div class="card-body p-4">
	                <!-- è¿”å›æŒ‰éˆ• -->
	                <div class="mb-4">
	                    <nav aria-label="breadcrumb">
	                        <ol class="breadcrumb">
	                            <li class="breadcrumb-item">
	                                <a href="/front-end/shopsys/shopindex.html">å•†åŸé¦–é </a>
	                            </li>
	                            <li class="breadcrumb-item">
	                                <a href="/front-end/shopsys/product.html">æ‰€æœ‰ç”¢å“</a>
	                            </li>
	                            <li class="breadcrumb-item active">${product.proName}</li>
	                        </ol>
	                    </nav>
	                </div>
	                
	                <div class="row">
	                    <!-- å•†å“åœ–ç‰‡ -->
	                    <div class="col-lg-6 mb-4">
	                        <div class="product-image-wrapper">
	                            <img src="${imageUrl}" 
	                                 alt="${product.proName}" 
	                                 class="img-fluid rounded shadow-sm w-100"
	                                 style="height: 400px; object-fit: cover;"
	                                 onerror="this.src='https://via.placeholder.com/400x400/667eea/ffffff?text=å•†å“åœ–ç‰‡'">
	                        </div>
	                    </div>
	                    
	                    <!-- å•†å“è³‡è¨Š -->
	                    <div class="col-lg-6">
	                        <h1 class="h2 mb-3 fw-bold">${product.proName || 'æœªçŸ¥å•†å“'}</h1>
	                        
	                        <div class="price-section mb-3 pb-3 border-bottom">
	                            <span class="h3 text-success fw-bold">NT$ ${formatPrice(product.proPrice || 0)}</span>
	                        </div>
	                        
	                        <!-- å•†å“ç‹€æ…‹é¡¯ç¤º -->
	                        <div class="status-section mb-3">
	                            <span class="${statusInfo.statusClass}">${statusInfo.displayText}</span>
	                        </div>
	                        
	                        <!-- åº«å­˜ç‹€æ…‹é¡¯ç¤ºï¼ˆä½¿ç”¨çœŸå¯¦è³‡æ–™ï¼‰-->
	                        <div class="stock-section mb-4 p-3 bg-light rounded">
	                            <div class="d-flex align-items-center gap-2 mb-2">
	                                <i class="bi bi-box-seam ${statusInfo.stockClass}"></i>
	                                <span class="fw-bold ${statusInfo.stockClass}">${statusInfo.stockText}</span>
	                            </div>
	                            <!-- åº«å­˜æ•¸é‡é¡¯ç¤º -->
	                            <div class="stock-quantity">
	                                <span class="text-muted">åº«å­˜æ•¸é‡ï¼š</span>
	                                <span class="fw-bold ${statusInfo.stockClass}">${statusInfo.stockCount}</span>
	                                
	                            </div>
	                        </div>
	                        
	                        <!-- å•†å“è¦æ ¼ -->
	                        <div class="product-info bg-light p-3 rounded mb-4">
	                            <div class="row">
	                                <div class="col-6">
	                                    <strong>ç‰ˆæœ¬ï¼š</strong><br>
	                                    <span class="text-muted">${product.proVersion || 'æ¨™æº–ç‰ˆ'}</span>
	                                </div>
	                                <div class="col-6">
	                                    <strong>å¹³å°ï¼š</strong><br>
	                                    <span class="text-muted">${platformName}</span>
	                                </div>
	                            </div>
	                        </div>
	                        
	                        <div class="product-description mb-4">
	                            <h5>å•†å“æè¿°</h5>
	                            <div class="description-content p-3 bg-light rounded">
	                            	${productDescription}
	                        	</div>
	                        </div>
	                        
	                        <!-- æ“ä½œæŒ‰éˆ•æ ¹æ“šåº«å­˜ç‹€æ…‹èª¿æ•´ -->
	                        <div class="action-buttons">
	                            <div class="row">
	                                <div class="col-md-6 mb-2">
	                                    <button class="btn ${statusInfo.canPurchase ? 'btn-success' : 'btn-secondary'} btn-lg w-100" 
	                                            ${statusInfo.canPurchase ? '' : 'disabled'}
	                                            onclick="handleAddToCart(${productId})">
	                                        <i class="bi bi-cart-plus me-2"></i>${statusInfo.buttonText}
	                                    </button>
	                                </div>
	                                <div class="col-md-6 mb-2">
	                                    <button class="btn btn-danger btn-lg w-100" onclick="handleAddToFavorite(${productId})">
	                                        <i class="bi bi-heart me-2"></i>åŠ å…¥æœ€æ„›
	                                    </button>
	                                </div>
	                                <div class="col-12">
	                                    <a href="/front-end/shopsys/product.html" class="btn btn-outline-secondary w-100">
	                                        <i class="bi bi-arrow-left me-2"></i>è¿”å›å•†å“åˆ—è¡¨
	                                    </a>
	                                </div>
	                            </div>
	                        </div>
	                    </div>
	                </div>
	            </div>
	        </div>
	    `;
	    
	    highlightCorrespondingTag(product.mallTagNo);
	}
	 
	
	// ğŸ”¥ æ–°å¢ï¼šç¼ºå°‘çš„ getProductDescription å‡½æ•¸
	function getProductDescription(product) {
	    console.log('ğŸ” Entity æª¢æŸ¥ - å•†å“å®Œæ•´è³‡æ–™:');
	    console.log('å®Œæ•´å•†å“ç‰©ä»¶:', JSON.stringify(product, null, 2));
	    
	    // ğŸ¯ æ ¹æ“šä½ çš„ Entityï¼Œæ‡‰è©²è¦æœ‰é€™äº›æ¬„ä½
	    console.log('ğŸ” æª¢æŸ¥ Entity æ¬„ä½:');
	    console.log('proDetails (PRO_DETAILS):', product.proDetails);
	    console.log('proInclude (PRO_INCLUDE):', product.proInclude);
	    console.log('proName:', product.proName);
	    console.log('id:', product.id);
	    
	    // å˜—è©¦ä¸åŒçš„æ¬„ä½ï¼Œå„ªå…ˆä½¿ç”¨ proDetails
	    let description = null;
	    let sourceField = null;
	    
	    // ç¬¬ä¸€å„ªå…ˆï¼šproDetails
	    if (product.proDetails && product.proDetails.toString().trim()) {
	        description = product.proDetails.toString().trim();
	        sourceField = 'proDetails';
	        console.log('âœ… ä½¿ç”¨ proDetails æ¬„ä½');
	    }
	    // ç¬¬äºŒå„ªå…ˆï¼šproInclude
	    else if (product.proInclude && product.proInclude.toString().trim()) {
	        description = product.proInclude.toString().trim();
	        sourceField = 'proInclude';
	        console.log('âœ… ä½¿ç”¨ proInclude æ¬„ä½');
	    }
	    
	    if (!description) {
	        console.error('âŒ proDetails å’Œ proInclude éƒ½æ²’æœ‰å…§å®¹');
	        
	        // é¡¯ç¤ºæ‰€æœ‰å­—ä¸²æ¬„ä½
	        const allStringFields = Object.keys(product).filter(key => {
	            const value = product[key];
	            return typeof value === 'string' && value.length > 0;
	        });
	        
	        console.log('ğŸ“‹ æ‰€æœ‰æœ‰å…§å®¹çš„å­—ä¸²æ¬„ä½:', allStringFields);
	        allStringFields.forEach(key => {
	            const value = product[key];
	            console.log(`  ${key}: "${value.substring(0, 50)}..."`);
	        });
	        
	        return `
	            <div class="alert alert-warning">
	                <h6><i class="bi bi-exclamation-triangle"></i> å•†å“æè¿°è³‡æ–™æª¢æŸ¥</h6>
	                <p><strong>Entity æ¬„ä½ç‹€æ…‹ï¼š</strong></p>
	                <ul class="mb-2">
	                    <li>proDetails: ${product.proDetails ? 'æœ‰è³‡æ–™ (' + product.proDetails.length + ' å­—å…ƒ)' : 'ç„¡è³‡æ–™æˆ–ç©ºç™½'}</li>
	                    <li>proInclude: ${product.proInclude ? 'æœ‰è³‡æ–™ (' + product.proInclude.length + ' å­—å…ƒ)' : 'ç„¡è³‡æ–™æˆ–ç©ºç™½'}</li>
	                </ul>
	                <p class="mb-0">è«‹æª¢æŸ¥è³‡æ–™åº«ä¸­ PRO_DETAILS æˆ– PRO_INCLUDE æ¬„ä½æ˜¯å¦æœ‰å…§å®¹ã€‚</p>
	            </div>
	        `;
	    }
	    
	    console.log(`ğŸ¯ ä½¿ç”¨æ¬„ä½: ${sourceField}`);
	    console.log(`ğŸ“„ å…§å®¹é•·åº¦: ${description.length} å­—å…ƒ`);
	    console.log(`ğŸ“ å…§å®¹é è¦½: ${description.substring(0, 100)}...`);
	    
	    return formatDescriptionText(description);
	}
	
	
	
	
	
	
	

	

	// ğŸ”¥ æ–°å¢ï¼šæ ¼å¼åŒ–æè¿°æ–‡å­—çš„å‡½æ•¸
	function formatDescriptionText(text) {
	    if (!text) return '<p class="text-muted">å•†å“è©³ç´°è³‡è¨Šæš«æœªæä¾›</p>';
	    
	    // æ¸…ç†å’Œæ ¼å¼åŒ–æ–‡å­—
	    let formattedText = text.toString().trim();
	    
	    // è™•ç†æ›è¡Œç¬¦è™Ÿ
	    formattedText = formattedText
	        .replace(/\r\n/g, '\n')        // çµ±ä¸€æ›è¡Œç¬¦è™Ÿ
	        .replace(/\r/g, '\n')          // è™•ç†èˆŠå¼æ›è¡Œ
	        .replace(/\n{3,}/g, '\n\n')    // é¿å…éå¤šç©ºè¡Œ
	        .replace(/\n/g, '<br>')        // æ›è¡Œè½‰ç‚º HTML
	        .replace(/\t/g, '&nbsp;&nbsp;&nbsp;&nbsp;'); // Tab è½‰ç©ºæ ¼
	    
	    // å¦‚æœæ–‡å­—å¾ˆé•·ï¼Œæ·»åŠ æ»¾å‹•æ¨£å¼
	    if (formattedText.length > 500) {
	        return `
	            <div style="max-height: 300px; overflow-y: auto; line-height: 1.6; padding: 10px; border: 1px solid #e0e0e0; border-radius: 5px;">
	                <p style="margin: 0; white-space: pre-wrap;">${formattedText}</p>
	            </div>
	        `;
	    } else {
	        return `<p style="line-height: 1.6; white-space: pre-wrap; margin: 0;">${formattedText}</p>`;
	    }
	}
		
	
	
	
	
	
	// ***  æ ¹æ“šåº«å­˜è³‡è¨Šç”Ÿæˆç‹€æ…‹ (è–°å¦¤ä¿®) ***//
	function generateStatusInfo(proIsmarket, proStatus, stockInfo) {
	    let statusInfo = {
	        displayText: 'ç‹€æ…‹æœªçŸ¥',
	        statusClass: 'badge bg-secondary',
	        stockText: 'åº«å­˜ç‹€æ…‹æœªçŸ¥',
	        stockClass: 'text-muted',
	        stockCount: 'æŸ¥è©¢ä¸­...',
	        
	        canPurchase: false,
	        buttonText: 'ç„¡æ³•è³¼è²·'
	    };
	    
	    // å¦‚æœæœ‰åº«å­˜è³‡è¨Šï¼Œä½¿ç”¨çœŸå¯¦è³‡æ–™
	    if (stockInfo && stockInfo.stock !== undefined) {
	        const realStock = stockInfo.stock;
	        const stockSource = stockInfo.stockSource || 'è³‡æ–™åº«';
	        
	        if (proIsmarket === '0' || proIsmarket === 0) {
	            // ä¸Šæ¶å•†å“
	            if (realStock > 0) {
	                if (proStatus === 'é è³¼ä¸­' || proStatus === 'é è³¼') {
	                    statusInfo = {
	                        displayText: 'é–‹æ”¾é è³¼',
	                        statusClass: 'badge bg-warning text-dark',
	                        stockText: 'é è³¼å•†å“ï¼Œç™¼å”®å¾Œå‡ºè²¨',
	                        stockClass: 'text-warning',
	                        stockCount: `${realStock} ä»¶`,
	                        
	                        canPurchase: true,
	                        buttonText: 'ç«‹å³é è³¼'
	                    };
	                } else {
	                    statusInfo = {
	                        displayText: 'ç¾è²¨ä¾›æ‡‰',
	                        statusClass: 'badge bg-success',
	                        stockText: realStock <= 10 ? 'åº«å­˜åä½ï¼Œæ¬²è³¼å¾é€Ÿ' : 'æœ‰ç¾è²¨ï¼Œç«‹å³ç™¼è²¨',
	                        stockClass: realStock <= 10 ? 'text-warning' : 'text-success',
	                        stockCount: `${realStock} ä»¶`,
	                        
	                        canPurchase: true,
	                        buttonText: 'åŠ å…¥è³¼ç‰©è»Š'
	                    };
	                }
	            } else {
	                // ç„¡åº«å­˜
	                statusInfo = {
	                    displayText: 'æš«æ™‚ç¼ºè²¨',
	                    statusClass: 'badge bg-danger',
	                    stockText: 'å•†å“æš«æ™‚ç¼ºè²¨',
	                    stockClass: 'text-danger',
	                    stockCount: '0 ä»¶',
	                    
	                    canPurchase: false,
	                    buttonText: 'æš«æ™‚ç¼ºè²¨'
	                };
	            }
	        } else {
	            // ä¸‹æ¶å•†å“
	            statusInfo = {
	                displayText: 'æš«åœè²©å”®',
	                statusClass: 'badge bg-danger',
	                stockText: 'å•†å“æš«æ™‚ä¸‹æ¶',
	                stockClass: 'text-danger',
	                stockCount: '0 ä»¶',
	                
	                canPurchase: false,
	                buttonText: 'æš«åœè²©å”®'
	            };
	        }
	    } else {
	        // ç„¡æ³•å–å¾—åº«å­˜è³‡è¨Šï¼Œä½¿ç”¨é è¨­é‚è¼¯
	        console.warn('âš ï¸ ç„¡åº«å­˜è³‡è¨Šï¼Œä½¿ç”¨é è¨­é¡¯ç¤º');
	        
	        if (proIsmarket === '0' || proIsmarket === 0) {
	            statusInfo = {
	                displayText: proStatus || 'å·²ç™¼å”®',
	                statusClass: 'badge bg-success',
	                stockText: 'å•†å“å¯è³¼è²·',
	                stockClass: 'text-success',
	                stockCount: 'æŸ¥è©¢ä¸­...',
	                
	                canPurchase: true,
	                buttonText: 'åŠ å…¥è³¼ç‰©è»Š'
	            };
	        } else {
	            statusInfo = {
	                displayText: 'æš«åœè²©å”®',
	                statusClass: 'badge bg-danger',
	                stockText: 'å•†å“æš«æ™‚ä¸‹æ¶',
	                stockClass: 'text-danger',
	                stockCount: '0 ä»¶',
	                
	                canPurchase: false,
	                buttonText: 'æš«åœè²©å”®'
	            };
	        }
	    }
	    
	    return statusInfo;
	}

	 
	 
	/**
	 * é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
	 */
	function showProductError(message) {
	    const container = document.getElementById('dynamic-content-container');
	    container.innerHTML = `
	        <div class="text-center py-5">
	            <i class="bi bi-exclamation-triangle display-1 text-danger"></i>
	            <h3 class="mt-3">è¼‰å…¥å¤±æ•—</h3>
	            <p class="text-muted">${message}</p>
	            <div class="mt-4">
	                <button class="btn btn-primary me-2" onclick="location.reload()">
	                    <i class="bi bi-arrow-clockwise"></i> é‡è©¦
	                </button>
	                <a href="/front-end/shopsys/product.html" class="btn btn-outline-secondary me-2">
	                    <i class="bi bi-grid"></i> å•†å“åˆ—è¡¨
	                </a>
	                <a href="/front-end/shopsys/shopindex.html" class="btn btn-outline-primary">
	                    <i class="bi bi-house"></i> å•†åŸé¦–é 
	                </a>
	            </div>
	        </div>
	    `;
	}

	
	//*** è™•ç†åŠ å…¥è³¼ç‰©è»Š (è–°å¦¤æœ‰åŠ å…¥å¯¦éš›å‘¼å«å¾Œç«¯ APIï¼ŒåŸæœ¬åªæœ‰é¡¯ç¤ºæç¤ºè¨Šæ¯)*** //
	async function handleAddToCart(productId) {
    console.log('åŠ å…¥è³¼ç‰©è»Š:', productId);
    
    // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
    const jwt = localStorage.getItem('jwt');
    if (!jwt) {
        showToast('è«‹å…ˆç™»å…¥æœƒå“¡ï¼', 'warning');
        // æœªç™»å…¥è·³è½‰åˆ°ç™»å…¥é é¢
        window.location.href = '/front-end/mem/MemberLogin.html';
        return;
    }
    
    try {
        // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        showToast('æ­£åœ¨åŠ å…¥è³¼ç‰©è»Š...', 'info');
        
        // å‘¼å«åŠ è³¼ç‰©è»Š API
        const response = await fetch('/api/cart/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'Authorization': 'Bearer ' + jwt
            },
            body: `proNo=${productId}&proNum=1`  // é è¨­æ•¸é‡ç‚º 1
        });
        
        if (response.ok) {
            const cartData = await response.json();
            console.log('åŠ è³¼ç‰©è»ŠæˆåŠŸ:', cartData);
            showToast('å•†å“å·²åŠ å…¥è³¼ç‰©è»Šï¼', 'success');
            
            // å¯é¸ï¼šæ›´æ–°é é¢ä¸Šçš„è³¼ç‰©è»Šæ•¸é‡é¡¯ç¤º
            updateCartBadge();
            
        } else {
            const errorText = await response.text();
            console.error('åŠ è³¼ç‰©è»Šå¤±æ•—:', response.status, errorText);
            
            if (response.status === 401) {
                showToast('ç™»å…¥å·²éæœŸï¼Œè«‹é‡æ–°ç™»å…¥ï¼', 'warning');
            } else {
                showToast('åŠ å…¥è³¼ç‰©è»Šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ï¼', 'error');
            }
        }
        
    	} catch (error) {
        console.error('ç¶²è·¯éŒ¯èª¤:', error);
        showToast('ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ï¼', 'error');
    	}
    
	}

	
	//*** è–°å¦¤æ–°å¢-æ›´æ–°è³¼ç‰©è»Šæ•¸é‡é¡¯ç¤ºï¼ˆå¦‚æœé é¢æœ‰è³¼ç‰©è»Šæ•¸é‡ï¼‰*** //
	function updateCartBadge() {
    // é€™å€‹å‡½æ•¸å¯ä»¥ç”¨ä¾†æ›´æ–° header ä¸­çš„è³¼ç‰©è»Šæ•¸é‡
    // å¦‚æœ header æœ‰è³¼ç‰©è»Šæ•¸é‡é¡¯ç¤ºçš„è©±
    console.log('å¯ä»¥åœ¨é€™è£¡æ›´æ–°è³¼ç‰©è»Šæ•¸é‡é¡¯ç¤º');
	}
	
	


	/**
	 * è™•ç†åŠ å…¥æœ€æ„›
	 */
	function handleAddToFavorite(productId) {
	    console.log('åŠ å…¥æœ€æ„›:', productId);
	    showToast('å·²åŠ å…¥æˆ‘çš„æœ€æ„›ï¼', 'info');
	}

	/**
	 * é¡¯ç¤ºæç¤ºè¨Šæ¯
	 */
	function showToast(message, type = 'success') {
	    const colors = {
	        success: '#28a745',
	        info: '#007bff',
	        warning: '#ffc107',
	        error: '#dc3545'
	    };
	    
	    const toast = document.createElement('div');
	    toast.style.cssText = `
	        position: fixed; top: 20px; right: 20px; 
	        background: ${colors[type] || colors.success}; color: white;
	        padding: 12px 20px; border-radius: 8px; z-index: 9999; 
	        font-weight: 500; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
	        animation: slideIn 0.3s ease;
	    `;
	    toast.textContent = message;
	    
	    // æ·»åŠ ç°¡å–®å‹•ç•«
	    const style = document.createElement('style');
	    style.textContent = `
	        @keyframes slideIn {
	            from { transform: translateX(100%); opacity: 0; }
	            to { transform: translateX(0); opacity: 1; }
	        }
	    `;
	    if (!document.getElementById('toast-animation')) {
	        style.id = 'toast-animation';
	        document.head.appendChild(style);
	    }
	    
	    document.body.appendChild(toast);
	    
	    setTimeout(() => {
	        if (toast.parentNode) {
	            toast.parentNode.removeChild(toast);
	        }
	    }, 3000);
	}

	/**
	 * æ ¼å¼åŒ–åƒ¹æ ¼
	 */
	function formatPrice(price) {
	    return new Intl.NumberFormat('zh-TW').format(price);
	}
	</script>
	
	
	

</body>
</html>