<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åƒç´ éƒ¨è½ - å•†åŸ - æ‰€æœ‰ç”¢å“</title>
<meta name="description" content="åƒç´ éƒ¨è½, Pixel Tribe, è™›æ“¬éŠæˆ²å•†åŸ - æ‰€æœ‰ç”¢å“">
<meta name="keywords" content="éŠæˆ²å•†åŸ, é›»ç«¶, éŠæˆ²ç©å®¶, å„ªæƒ æ´»å‹•, å•†å“è³¼è²·, æ‰€æœ‰ç”¢å“">
<meta name="robots" content="all,follow">
<script src="/js/dynamicHeaderInfo.js"></script>
<script>
	//Check local storage
	let localS = localStorage.getItem('theme')
	themeToSet = localS

	// If local storage is not set, we check the OS preference
	if (!localS) {
		themeToSet = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
	}

	//Set the correct theme
	document.documentElement.setAttribute('data-theme', themeToSet)
</script>

<!-- çµ±ä¸€ç”¨çµ•å°è·¯ç¶“  -->
<link rel="stylesheet" href="/assets/vendors/bootstrap/bootstrap.min.css">
<link rel="stylesheet" href="/assets/vendors/bootstrap-icons/bootstrap-icons.css">
<link rel="stylesheet" href="/assets/vendors/simplebar/simplebar.min.css">
<link rel="stylesheet" href="/assets/vendors/aos/aos.css">
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet" href="/assets/css/responsive.css">
<link rel="stylesheet" href="/assets/css/custom-style.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Karla&display=swap" rel="stylesheet">

</head>

<body>
	<div class="switcher switcher-show" id="theme-switcher">
		<i id="switcher-icon" class="bi bi-moon"></i>
	</div>

	<a href="#" id="back-to-top"></a>

	<div class="vine-wrapper">

		<div id="header-placeholder"></div>

		<section class="vine-hero-2 bg-img-1">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<div class="hero-content" data-aos="fade-down" data-aos-easing="linear">
							<h1>åƒç´ éƒ¨è½(Pixel Tribe)</h1>
							<p>éŠæˆ²æ„›å¥½è€…çš„èšé›†åœ° - æ‰€æœ‰ç”¢å“</p>
						</div>
					</div>
				</div>
			</div>
		</section>

		<section class="vine-main">
			<div class="container">
				<div class="row">
					<div class="col-lg-3 pe-lg-3 border-end">
						<div class="position-sticky" style="top: 100px;">
							<div class="mall-category-sidebar">
								<h5 class="mb-3">å¹³å°åˆ†é¡</h5>
								<div id="malltag-list">
									<!-- åˆ†é¡é …ç›®æœƒç”± malltag.js å‹•æ…‹è¼‰å…¥ -->
								</div>
								
								<!-- è¿”å›å•†åŸé¦–é æŒ‰éˆ• <<ä¿®æ­£çµ±ä¸€ç”¨å°è·¯å¾‘>> -->
								<div class="mt-4">
									<a href="/front-end/shopsys/shopindex.html" class="btn btn-outline-primary w-100">
										<i class="bi bi-house me-2"></i>è¿”å›å•†åŸé¦–é 
									</a>
								</div>
							</div>
						</div>
					</div>

					<div class="col-lg-9 ps-lg-5">
						<div id="dynamic-content-container">
							<!-- å•†å“åˆ—è¡¨æœƒç”± malltag.js å‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
						</div>
					</div>
				</div>
			</div>
		</section>
		
		<div id="footer-placeholder"></div>

	</div>
	
	<!-- ä¿®æ­£çµ±ä¸€ç”¨å°è·¯å¾‘ -->
	<script src="/assets/vendors/jquery/jquery.min.js"></script>
	<script src="/assets/vendors/bootstrap/bootstrap.bundle.js"></script>
	<script src="/assets/vendors/popper/popper.min.js"></script>
	<script src="/assets/vendors/simplebar/simplebar.min.js"></script>
	<script src="/assets/vendors/aos/aos.js"></script>
	<script src="/assets/js/main.js"></script>
	<script src="/assets/js/global-loader.js"></script>
	
	<!-- ä¿®æ­£çµ±ä¸€ç”¨å°è·¯å¾‘ -->
	<script src="/front-end/shopsys/malltag.js"></script>
	<!-- <script src="/front-end/shopsysproductDetail.js"></script> -->
	
	<script>
	//*** é é¢åˆå§‹åŒ– - ç°¡åŒ–ç‰ˆï¼Œè®“ malltag.js å®Œå…¨æ¥ç®¡ ***//
	
	//*** é é¢åˆå§‹åŒ– - é©é…çµ„å“¡çš„æ··æ·†çµæ§‹ ***//
	document.addEventListener('DOMContentLoaded', function() {
	    setTimeout(function() {
	        try {
	            console.log('å•†å“é é¢åˆå§‹åŒ–...');
	            
	            // æª¢æŸ¥ URL åƒæ•¸
	            const urlParams = new URLSearchParams(window.location.search);
	            const productId = urlParams.get('id');
	            
	            if (productId) {
	                // æœ‰å•†å“IDï¼Œé¡¯ç¤ºå•†å“è©³æƒ…
	                console.log('é¡¯ç¤ºå•†å“è©³æƒ…ï¼ŒID:', productId);
	                showProductDetail(productId);
	            } else {
	                // æ²’æœ‰å•†å“IDï¼Œé¡¯ç¤ºå•†å“åˆ—è¡¨ï¼ˆä¿æŒçµ„å“¡åŸæœ‰é‚è¼¯ï¼‰
	                console.log('é¡¯ç¤ºå•†å“åˆ—è¡¨ï¼Œåˆå§‹åŒ– MallTagManager...');
	                
	                if (window.mallTagManager && typeof window.mallTagManager.init === 'function') {
	                    window.mallTagManager.init();
	                } else {
	                    console.warn('MallTagManager æœªæ‰¾åˆ°ï¼Œå˜—è©¦æ‰‹å‹•åˆå§‹åŒ–...');
	                    // å¦‚æœ malltag.js é‚„æ²’è¼‰å…¥ï¼Œç¨å¾Œå†è©¦
	                    setTimeout(() => {
	                        if (window.mallTagManager) {
	                            window.mallTagManager.init();
	                        }
	                    }, 500);
	                }
	            }
	            
	        } catch (error) {
	            console.error('é é¢åˆå§‹åŒ–éŒ¯èª¤:', error);
	        }
	    }, 300);
	});

	/**
	 * é¡¯ç¤ºå•†å“è©³æƒ… - æœ€å°ä¾µå…¥å¼å¯¦ç¾
	 */
	async function showProductDetail(productId) {
	    try {
	        console.log('é–‹å§‹è¼‰å…¥å•†å“è©³æƒ…ï¼ŒID:', productId);
	        
	        // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
	        const container = document.getElementById('dynamic-content-container');
	        if (!container) {
	            console.error('æ‰¾ä¸åˆ° dynamic-content-container');
	            return;
	        }
	        
	        container.innerHTML = `
	            <div class="text-center py-5">
	                <div class="spinner-border text-primary" role="status"></div>
	                <h4 class="mt-3">è¼‰å…¥å•†å“è³‡è¨Šä¸­...</h4>
	                <p class="text-muted">è«‹ç¨å€™</p>
	            </div>
	        `;
	        
	        // ä½¿ç”¨å’Œ productList.js ç›¸åŒçš„ API
	        const apiBaseUrl = `${location.origin}/api`;
	        const apiUrl = `${apiBaseUrl}/product/searchall?proIsMarket=0`;
	        
	        console.log('è«‹æ±‚ API:', apiUrl);
	        
	        const response = await fetch(apiUrl);
	        if (!response.ok) {
	            throw new Error(`HTTP error! status: ${response.status}`);
	        }

	        const products = await response.json();
	        console.log('è¼‰å…¥å•†å“åˆ—è¡¨:', products.length, 'é …');
	        
	        // å°‹æ‰¾ç›®æ¨™å•†å“
	        const product = products.find(p => 
	            String(p.id) === String(productId) || 
	            String(p.proNo) === String(productId)
	        );

	        if (!product) {
	            throw new Error(`æ‰¾ä¸åˆ°å•†å“ ID: ${productId}`);
	        }

	        console.log('æ‰¾åˆ°ç›®æ¨™å•†å“:', product);
	        
	        // é¡¯ç¤ºå•†å“è©³æƒ…
	        displayProductDetail(product);
	        
	    } catch (error) {
	        console.error('è¼‰å…¥å•†å“è©³æƒ…å¤±æ•—:', error);
	        showProductError(error.message);
	    }
	}

	/**
	 * é¡¯ç¤ºå•†å“è©³æƒ…å…§å®¹
	 */
	 function displayProductDetail(product) {
		    
		    
		    const container = document.getElementById('dynamic-content-container');
		    
		    // ğŸ”¥ æ¸¬è©¦å¹³å°é‚è¼¯
		    let platformName = 'æ¸¬è©¦å¹³å°';
		    if (product.mallTagNo) {
		        if (typeof product.mallTagNo === 'object' && product.mallTagNo.mallTagName) {
		            platformName = product.mallTagNo.mallTagName;
		            console.log('âœ… å¾ç‰©ä»¶å–å¾—å¹³å°:', platformName);
		        } else if (typeof product.mallTagNo === 'number') {
		            const platformMap = {
		                1: 'Steam',
		                2: 'PlayStation',
		                3: 'Xbox',
		                4: 'Nintendo Switch',
		                5: 'Epic Games Store'
		            };
		            platformName = platformMap[product.mallTagNo] || `å¹³å° ${product.mallTagNo}`;
		            console.log('âœ… å¾æ•¸å­—æ˜ å°„å–å¾—å¹³å°:', platformName);
		        }
		    }
		    
		    console.log('æœ€çµ‚å¹³å°åç¨±:', platformName);
		    console.log('æœ€çµ‚ç‰ˆæœ¬:', product.proVersion);
		    
		    // ç²å–å•†å“ç‹€æ…‹
		    const proIsmarket = product.proIsmarket;
		    let statusText = 'ç‹€æ…‹æœªçŸ¥';
		    let statusClass = 'badge bg-secondary';
		    
		    if (proIsmarket === '0' || proIsmarket === 0) {
		        statusText = product.proStatus || 'å·²ç™¼å”®';
		        statusClass = 'badge bg-success';
		    } else if (proIsmarket === '1' || proIsmarket === 1) {
		        statusText = product.proStatus || 'é è³¼ä¸­';
		        statusClass = 'badge bg-warning text-dark';
		    }
		    
		    const productId = product.id || product.proNo;
		    const apiBaseUrl = `${location.origin}/api`;
		    const imageUrl = `${apiBaseUrl}/product/cover/${productId}`;
		    
		    // æ›´æ–°é é¢æ¨™é¡Œ
		    document.title = `${product.proName} - åƒç´ éƒ¨è½`;
		    
		    // æ›´æ–° hero å€åŸŸæ¨™é¡Œ
		    const heroContent = document.querySelector('.hero-content p');
		    if (heroContent) {
		        heroContent.textContent = `å•†å“è©³æƒ… - ${product.proName}`;
		    }
		    
		    // ğŸ”¥ ä¿®æ­£ï¼šä½¿ç”¨è¨ˆç®—å¾Œçš„å¹³å°å’Œç‰ˆæœ¬
		    container.innerHTML = `
		        <div class="card shadow-sm border-0">
		            <div class="card-body p-4">
		                <!-- è¿”å›æŒ‰éˆ• -->
		                <div class="mb-4">
		                    <nav aria-label="breadcrumb">
		                        <ol class="breadcrumb">
		                            <li class="breadcrumb-item">
		                                <a href="/front-end/shopsys/shopindex.html">å•†åŸé¦–é </a>
		                            </li>
		                            <li class="breadcrumb-item">
		                                <a href="/front-end/shopsys/product.html">æ‰€æœ‰ç”¢å“</a>
		                            </li>
		                            <li class="breadcrumb-item active">${product.proName}</li>
		                        </ol>
		                    </nav>
		                </div>
		                
		                <div class="row">
		                    <!-- å•†å“åœ–ç‰‡ -->
		                    <div class="col-lg-6 mb-4">
		                        <div class="product-image-wrapper">
		                            <img src="${imageUrl}" 
		                                 alt="${product.proName}" 
		                                 class="img-fluid rounded shadow-sm w-100"
		                                 style="height: 400px; object-fit: cover;"
		                                 onerror="this.src='https://via.placeholder.com/400x400/667eea/ffffff?text=å•†å“åœ–ç‰‡'">
		                        </div>
		                    </div>
		                    
		                    <!-- å•†å“è³‡è¨Š -->
		                    <div class="col-lg-6">
		                        <h1 class="h2 mb-3 fw-bold">${product.proName || 'æœªçŸ¥å•†å“'}</h1>
		                        
		                        <div class="price-section mb-3 pb-3 border-bottom">
		                            <span class="h3 text-success fw-bold">NT$ ${formatPrice(product.proPrice || 0)}</span>
		                        </div>
		                        
		                        <div class="status-section mb-4">
		                            <span class="${statusClass}">${statusText}</span>
		                        </div>
		                        
		                        <!-- ğŸ”¥ ä¿®æ­£ï¼šä½¿ç”¨è¨ˆç®—å¾Œçš„å€¼ -->
		                        <div class="product-info bg-light p-3 rounded mb-4">
		                            <div class="row">
		                                <div class="col-6">
		                                    <strong>ç‰ˆæœ¬ï¼š</strong><br>
		                                    <span class="text-muted">${product.proVersion || 'æ¨™æº–ç‰ˆ'}</span>
		                                </div>
		                                <div class="col-6">
		                                    <strong>å¹³å°ï¼š</strong><br>
		                                    <span class="text-muted">${platformName}</span>
		                                </div>
		                            </div>
		                        </div>
		                        
		                        <div class="product-description mb-4">
		                            <h5>å•†å“æè¿°</h5>
		                            <p class="text-muted">
		                                ${product.proDescription || product.proDetails || 'é€™æ˜¯ä¸€æ¬¾å„ªè³ªçš„éŠæˆ²ç”¢å“ï¼Œç‚ºæ‚¨å¸¶ä¾†æ¥µè‡´çš„éŠæˆ²é«”é©—ã€‚'}
		                            </p>
		                        </div>
		                        
		                        <!-- æ“ä½œæŒ‰éˆ• -->
		                        <div class="action-buttons">
		                        <div class="row">
		                            <div class="col-md-6 mb-2">
		                                <button class="btn btn-success btn-lg w-100" onclick="handleAddToCart(${productId})">
		                                    <i class="bi bi-cart-plus me-2"></i>åŠ å…¥è³¼ç‰©è»Š
		                                </button>
		                            </div>
		                            <div class="col-md-6 mb-2">
		                                <button class="btn btn-danger btn-lg w-100" onclick="handleAddToFavorite(${productId})">
		                                    <i class="bi bi-heart me-2"></i>åŠ å…¥æœ€æ„›
		                                </button>
		                            </div>
		                            <div class="col-12">
		                                <a href="/front-end/shopsys/product.html" class="btn btn-outline-secondary w-100">
		                                    <i class="bi bi-arrow-left me-2"></i>è¿”å›å•†å“åˆ—è¡¨
		                                </a>
		                            </div>
		                        </div>
		                    </div>
		                    </div>
		                </div>
		            </div>
		        </div>
		    `;
		}
	 
	 
	 
	 
	 
	 
	 
	 
	 
	/**
	 * é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
	 */
	function showProductError(message) {
	    const container = document.getElementById('dynamic-content-container');
	    container.innerHTML = `
	        <div class="text-center py-5">
	            <i class="bi bi-exclamation-triangle display-1 text-danger"></i>
	            <h3 class="mt-3">è¼‰å…¥å¤±æ•—</h3>
	            <p class="text-muted">${message}</p>
	            <div class="mt-4">
	                <button class="btn btn-primary me-2" onclick="location.reload()">
	                    <i class="bi bi-arrow-clockwise"></i> é‡è©¦
	                </button>
	                <a href="/front-end/shopsys/product.html" class="btn btn-outline-secondary me-2">
	                    <i class="bi bi-grid"></i> å•†å“åˆ—è¡¨
	                </a>
	                <a href="/front-end/shopsys/shopindex.html" class="btn btn-outline-primary">
	                    <i class="bi bi-house"></i> å•†åŸé¦–é 
	                </a>
	            </div>
	        </div>
	    `;
	}

	
	//*** è™•ç†åŠ å…¥è³¼ç‰©è»Š (è–°å¦¤æœ‰åŠ å…¥å¯¦éš›å‘¼å«å¾Œç«¯ APIï¼ŒåŸæœ¬åªæœ‰é¡¯ç¤ºæç¤ºè¨Šæ¯)*** //
	async function handleAddToCart(productId) {
    console.log('åŠ å…¥è³¼ç‰©è»Š:', productId);
    
    // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
    const jwt = localStorage.getItem('jwt');
    if (!jwt) {
        showToast('è«‹å…ˆç™»å…¥æœƒå“¡ï¼', 'warning');
        // æœªç™»å…¥è·³è½‰åˆ°ç™»å…¥é é¢
        window.location.href = '/front-end/mem/MemberLogin.html';
        return;
    }
    
    try {
        // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        showToast('æ­£åœ¨åŠ å…¥è³¼ç‰©è»Š...', 'info');
        
        // å‘¼å«åŠ è³¼ç‰©è»Š API
        const response = await fetch('/api/cart/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'Authorization': 'Bearer ' + jwt
            },
            body: `proNo=${productId}&proNum=1`  // é è¨­æ•¸é‡ç‚º 1
        });
        
        if (response.ok) {
            const cartData = await response.json();
            console.log('åŠ è³¼ç‰©è»ŠæˆåŠŸ:', cartData);
            showToast('å•†å“å·²åŠ å…¥è³¼ç‰©è»Šï¼', 'success');
            
            // å¯é¸ï¼šæ›´æ–°é é¢ä¸Šçš„è³¼ç‰©è»Šæ•¸é‡é¡¯ç¤º
            updateCartBadge();
            
        } else {
            const errorText = await response.text();
            console.error('åŠ è³¼ç‰©è»Šå¤±æ•—:', response.status, errorText);
            
            if (response.status === 401) {
                showToast('ç™»å…¥å·²éæœŸï¼Œè«‹é‡æ–°ç™»å…¥ï¼', 'warning');
            } else {
                showToast('åŠ å…¥è³¼ç‰©è»Šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ï¼', 'error');
            }
        }
        
    	} catch (error) {
        console.error('ç¶²è·¯éŒ¯èª¤:', error);
        showToast('ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ï¼', 'error');
    	}
    
	}

	
	//*** è–°å¦¤æ–°å¢-æ›´æ–°è³¼ç‰©è»Šæ•¸é‡é¡¯ç¤ºï¼ˆå¦‚æœé é¢æœ‰è³¼ç‰©è»Šæ•¸é‡ï¼‰*** //
	function updateCartBadge() {
    // é€™å€‹å‡½æ•¸å¯ä»¥ç”¨ä¾†æ›´æ–° header ä¸­çš„è³¼ç‰©è»Šæ•¸é‡
    // å¦‚æœ header æœ‰è³¼ç‰©è»Šæ•¸é‡é¡¯ç¤ºçš„è©±
    console.log('å¯ä»¥åœ¨é€™è£¡æ›´æ–°è³¼ç‰©è»Šæ•¸é‡é¡¯ç¤º');
	}
	
	


	/**
	 * è™•ç†åŠ å…¥æœ€æ„›
	 */
	function handleAddToFavorite(productId) {
	    console.log('åŠ å…¥æœ€æ„›:', productId);
	    showToast('å·²åŠ å…¥æˆ‘çš„æœ€æ„›ï¼', 'info');
	}

	/**
	 * é¡¯ç¤ºæç¤ºè¨Šæ¯
	 */
	function showToast(message, type = 'success') {
	    const colors = {
	        success: '#28a745',
	        info: '#007bff',
	        warning: '#ffc107',
	        error: '#dc3545'
	    };
	    
	    const toast = document.createElement('div');
	    toast.style.cssText = `
	        position: fixed; top: 20px; right: 20px; 
	        background: ${colors[type] || colors.success}; color: white;
	        padding: 12px 20px; border-radius: 8px; z-index: 9999; 
	        font-weight: 500; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
	        animation: slideIn 0.3s ease;
	    `;
	    toast.textContent = message;
	    
	    // æ·»åŠ ç°¡å–®å‹•ç•«
	    const style = document.createElement('style');
	    style.textContent = `
	        @keyframes slideIn {
	            from { transform: translateX(100%); opacity: 0; }
	            to { transform: translateX(0); opacity: 1; }
	        }
	    `;
	    if (!document.getElementById('toast-animation')) {
	        style.id = 'toast-animation';
	        document.head.appendChild(style);
	    }
	    
	    document.body.appendChild(toast);
	    
	    setTimeout(() => {
	        if (toast.parentNode) {
	            toast.parentNode.removeChild(toast);
	        }
	    }, 3000);
	}

	/**
	 * æ ¼å¼åŒ–åƒ¹æ ¼
	 */
	function formatPrice(price) {
	    return new Intl.NumberFormat('zh-TW').format(price);
	}
	</script>
	
	
	

</body>
</html>